<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha Druida Elementalista</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #7e22ce;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subclass {
            text-align: center;
            color: #2a5298;
            margin-bottom: 30px;
            font-style: italic;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-box label {
            display: block;
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .stat-box input, .stat-box .display {
            width: 80px;
            padding: 8px;
            border: none;
            border-radius: 5px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
        }

        .stat-box input {
            width: 60px;
        }

        .stat-box .display {
            background: rgba(255, 255, 255, 0.95);
            display: inline-block;
            padding: 10px 20px;
        }

        .hp-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            color: white;
        }

        .hp-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .hp-display {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }

        .hp-buttons {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-damage {
            background: #e74c3c;
            color: white;
        }

        .btn-heal {
            background: #2ecc71;
            color: white;
        }

        .btn-rest {
            background: #3498db;
            color: white;
            font-size: 1.1em;
            padding: 15px 30px;
        }

        .btn-short-rest {
            background: #95a5a6;
        }

        .resources {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .resource-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .resource-box h3 {
            margin-bottom: 15px;
            color: #d35400;
        }

        .charges {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .charge {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #bdc3c7;
            cursor: pointer;
            transition: all 0.3s;
        }

        .charge.active {
            background: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.6);
        }

        .spell-slots {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .spell-slots h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #16a085;
        }

        .slot-level {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
        }

        .slot-level label {
            font-weight: bold;
            min-width: 80px;
            color: #16a085;
        }

        .slots {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .slot {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #bdc3c7;
            cursor: pointer;
            transition: all 0.3s;
        }

        .slot.active {
            background: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.6);
        }

        .spells-section {
            margin-bottom: 30px;
        }

        .spell-category {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .spell-category h3 {
            margin-bottom: 15px;
            color: #d63031;
            border-bottom: 2px solid #d63031;
            padding-bottom: 10px;
        }

        .spell-list {
            display: grid;
            gap: 10px;
        }

        .spell-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spell-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .spell-name {
            flex: 1;
            font-weight: 500;
        }

        .spell-level {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .locked {
            opacity: 0.5;
            pointer-events: none;
        }

        .rest-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .prepared-count {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #e74c3c;
        }

        /* Popup Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: slideIn 0.3s;
        }

        .modal-content h2 {
            color: #7e22ce;
            margin-bottom: 10px;
        }

        .modal-content .spell-meta {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-content .spell-description {
            line-height: 1.6;
            color: #2c3e50;
        }

        .modal-content .spell-description strong {
            color: #7e22ce;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            color: #95a5a6;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #e74c3c;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Swap button */
        .btn-swap {
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-swap:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .btn-add-spell {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            display: block;
            margin: 15px auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-add-spell:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .empty-slot {
            background: rgba(255, 255, 255, 0.4);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px dashed #bdc3c7;
        }

        .empty-slot .spell-name {
            color: #95a5a6;
            font-style: italic;
        }

        .spell-item-clickable {
            cursor: pointer;
            transition: background 0.3s;
        }

        .spell-item-clickable:hover {
            background: rgba(52, 152, 219, 0.2) !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔥💧🌍💨 Druida Elementalista</h1>
        <p class="subclass">Circle of the Elementalists</p>

        <!-- Stats -->
        <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr);">
            <div class="stat-box">
                <label>Nivel</label>
                <input type="number" id="level" value="10" min="1" max="20">
            </div>
            <div class="stat-box">
                <label>Sabiduría</label>
                <input type="number" id="wisdom" value="20" min="1" max="30">
            </div>
            <div class="stat-box">
                <label>Destreza</label>
                <input type="number" id="dexterity" value="14" min="1" max="30">
            </div>
            <div class="stat-box" style="cursor: pointer;" onclick="toggleElementalArmor()">
                <label>Elemental Armor</label>
                <div class="display" id="elemental-armor" style="font-size: 2em; padding: 5px 20px;">✓</div>
            </div>
            <div class="stat-box" style="cursor: pointer;" onclick="cyclePendantLevel()">
                <label>Pendant Level</label>
                <div class="display" id="pendant-level" style="font-size: 0.9em; padding: 10px;">Dormant</div>
            </div>
        </div>

        <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr); margin-top: 15px;">
            <div class="stat-box">
                <label>Bonus Competencia</label>
                <div class="display" id="prof-bonus">+4</div>
            </div>
            <div class="stat-box">
                <label>Modificador SAB</label>
                <div class="display" id="wis-mod">+5</div>
            </div>
            <div class="stat-box">
                <label>Modificador DES</label>
                <div class="display" id="dex-mod">+2</div>
            </div>
            <div class="stat-box">
                <label>AC</label>
                <div class="display" id="ac">18</div>
            </div>
            <div class="stat-box">
                <label>CD de Salvación</label>
                <div class="display" id="spell-dc">17</div>
            </div>
        </div>

        <!-- HP -->
        <div class="hp-section">
            <h3 style="text-align: center; margin-bottom: 10px;">Puntos de Golpe</h3>
            <div class="hp-display">
                <span id="current-hp">70</span> / <span id="max-hp">70</span>
            </div>
            <div class="hp-controls">
                <div class="hp-buttons">
                    <button class="btn-damage" onclick="modifyHP(-5)">-5</button>
                    <button class="btn-damage" onclick="modifyHP(-1)">-1</button>
                </div>
                <input type="number" id="hp-input" placeholder="Cantidad" style="width: 100px; padding: 8px; border-radius: 5px; border: none; text-align: center;">
                <div class="hp-buttons">
                    <button class="btn-heal" onclick="modifyHP(1)">+1</button>
                    <button class="btn-heal" onclick="modifyHP(5)">+5</button>
                </div>
            </div>
        </div>

        <!-- Resources -->
        <div class="resources">
            <div class="resource-box">
                <h3>Wild Shape</h3>
                <div class="charges" id="wild-shape-charges"></div>
            </div>
        </div>

        <!-- Spell Slots -->
        <div class="spell-slots">
            <h3>Espacios de Conjuro</h3>
            <div id="spell-slots-container"></div>
        </div>

        <!-- Spells -->
        <div class="spells-section">
            <div class="spell-category">
                <h3>Siempre Preparados</h3>
                <div class="spell-list" id="always-prepared"></div>
            </div>

            <div class="spell-category">
                <h3>Hechizos Elementalistas</h3>
                <div class="spell-list" id="elementalist-spells"></div>
            </div>

            <div class="spell-category" id="aether-category" style="display: none;">
                <h3>Hechizos de Aether (Nivel 10)</h3>
                <div class="spell-list" id="aether-spells"></div>
            </div>

            <div class="spell-category">
                <h3>Hechizos de Druida</h3>
                <p class="prepared-count">Preparados: <span id="prepared-count">0</span> / <span id="max-prepared">0</span></p>
                <div class="spell-list" id="druid-spells"></div>
            </div>
        </div>

        <!-- Rest Buttons -->
        <div class="rest-buttons">
            <button class="btn-rest btn-short-rest" onclick="shortRest()">Descanso Corto</button>
            <button class="btn-rest" onclick="longRest()">Descanso Largo</button>
        </div>
    </div>

    <!-- Spell Description Modal -->
    <div id="spell-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSpellModal()">&times;</span>
            <h2 id="modal-spell-name"></h2>
            <div class="spell-meta" id="modal-spell-meta"></div>
            <div class="spell-description" id="modal-spell-description"></div>
        </div>
    </div>

    <!-- Swap Spell Modal -->
    <div id="swap-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSwapModal()">&times;</span>
            <h2>Cambiar Hechizo</h2>
            <p id="swap-current-spell" style="margin-bottom: 20px; color: #7f8c8d;"></p>
            <div id="swap-spell-list" style="max-height: 400px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // Character data
        let character = {
            level: 10,
            wisdom: 20,
            dexterity: 14,
            elementalArmor: true,
            pendantLevel: 'Dormant', // Dormant, Awakened, Exalted
            currentHP: 103,
            maxHP: 103,
            wildShapeCharges: { current: 3, max: 3 },
            spellSlots: {
                1: { current: 4, max: 4 },
                2: { current: 3, max: 3 },
                3: { current: 3, max: 3 },
                4: { current: 3, max: 3 },
                5: { current: 2, max: 2 }
            },
            preparedSpells: [],
            elementalistSlots: {
                cantrip: null,
                level1: null,
                level2: null,
                level3: null,
                level4: null,
                level5: null
            },
            aetherSlots: {
                cantrip: null,
                level1: null,
                level2: null,
                level3: null,
                level4: null,
                level5: null
            }
        };

        // Spell lists
        const alwaysPreparedBase = [
            { name: "Gust", level: "C", id: "gust" },
            { name: "Speak with Animals", level: "1st", id: "speak-animals" },
            { name: "Find Familiar", level: "1st", id: "find-familiar" }
        ];

        const sorcerusBurst = { name: "Sorcerous Burst", level: "C", id: "sorcerous-burst" };

        // Function to get always prepared spells based on level
        function getAlwaysPrepared() {
            const spells = [...alwaysPreparedBase];
            if (character.level >= 6) {
                spells.splice(1, 0, sorcerusBurst); // Add after Gust
            }
            return spells;
        }

        // Function to get max spell level available based on character level
        function getMaxSpellLevel() {
            const level = character.level;
            if (level >= 17) return 9;
            if (level >= 15) return 8;
            if (level >= 13) return 7;
            if (level >= 11) return 6;
            if (level >= 9) return 5;
            if (level >= 7) return 4;
            if (level >= 5) return 3;
            if (level >= 3) return 2;
            return 1;
        }

        // Function to convert spell level string to number
        function spellLevelToNumber(levelStr) {
            if (levelStr === 'C') return 0;
            return parseInt(levelStr.replace(/[^0-9]/g, ''));
        }

        // Get all spell IDs currently in elementalist slots
        function getElementalistSpellIds() {
            const ids = [];
            for (let key in character.elementalistSlots) {
                if (character.elementalistSlots[key]) {
                    ids.push(character.elementalistSlots[key].id);
                }
            }
            return ids;
        }

        function getAetherSpellIds() {
            const ids = [];
            for (let key in character.aetherSlots) {
                if (character.aetherSlots[key]) {
                    ids.push(character.aetherSlots[key].id);
                }
            }
            return ids;
        }

        function getAllLockedSpellIds() {
            return [...getElementalistSpellIds(), ...getAetherSpellIds()];
        }

        // Elementalist spell slots configuration
        function getElementalistSlotConfig() {
            const level = character.level;
            const config = [
                { key: 'cantrip', label: 'Cantrip', spellLevel: 'C', unlockLevel: 3 },
                { key: 'level1', label: 'Nivel 1', spellLevel: '1st', unlockLevel: 3 },
                { key: 'level2', label: 'Nivel 2', spellLevel: '2nd', unlockLevel: 3 },
                { key: 'level3', label: 'Nivel 3', spellLevel: '3rd', unlockLevel: 5 },
                { key: 'level4', label: 'Nivel 4', spellLevel: '4th', unlockLevel: 7 },
                { key: 'level5', label: 'Nivel 5', spellLevel: '5th', unlockLevel: 9 }
            ];
            return config.filter(slot => level >= slot.unlockLevel);
        }

        // Aether spell slots configuration (Level 10 feature)
        function getAetherSlotConfig() {
            const level = character.level;
            const config = [
                { key: 'cantrip', label: 'Cantrip', spellLevel: 'C', unlockLevel: 10 },
                { key: 'level1', label: 'Nivel 1', spellLevel: '1st', unlockLevel: 10 },
                { key: 'level2', label: 'Nivel 2', spellLevel: '2nd', unlockLevel: 10 },
                { key: 'level3', label: 'Nivel 3', spellLevel: '3rd', unlockLevel: 10 },
                { key: 'level4', label: 'Nivel 4', spellLevel: '4th', unlockLevel: 10 },
                { key: 'level5', label: 'Nivel 5', spellLevel: '5th', unlockLevel: 10 }
            ];
            return config.filter(slot => level >= slot.unlockLevel);
        }

        const druidSpells = [
            { name: "Absorb Elements", level: "1st", id: "absorb" },
            { name: "Spring's Touch", level: "1st", id: "spring" },
            { name: "Cure Wounds", level: "1st", id: "cure" },
            { name: "Healing Word", level: "1st", id: "healing-word" },
            { name: "Detect Magic (R)", level: "1st", id: "detect" },
            { name: "Create or Destroy Water", level: "1st", id: "create-water" },
            { name: "Earth Shield", level: "1st", id: "earth-shield" },
            { name: "Earth Tremor", level: "1st", id: "earth-tremor" },
            { name: "Warding Wind", level: "2nd", id: "warding" },
            { name: "Continual Flame", level: "2nd", id: "continual-flame" },
            { name: "Flame Blade", level: "2nd", id: "flame-blade" },
            { name: "Flaming Sphere", level: "2nd", id: "flaming-sphere" },
            { name: "Heat Metal", level: "2nd", id: "heat-metal" },
            { name: "Pass without Trace", level: "2nd", id: "pass" },
            { name: "Hold Person", level: "2nd", id: "hold" },
            { name: "Enhance Ability", level: "2nd", id: "enhance" },
            { name: "Aura of Vitality", level: "3rd", id: "aura" },
            { name: "Dispel Magic", level: "3rd", id: "dispel-magic" },
            { name: "Elemental Weapon", level: "3rd", id: "elemental-weapon" },
            { name: "Erupting Earth", level: "3rd", id: "erupting-earth" },
            { name: "Protection from Energy", level: "3rd", id: "protection-energy" },
            { name: "Riptides", level: "3rd", id: "riptides" },
            { name: "Tidal Wave", level: "3rd", id: "tidal-wave" },
            { name: "Wall of Water", level: "3rd", id: "wall-water" },
            { name: "Water Breathing", level: "3rd", id: "water-breathing" },
            { name: "Water Walk", level: "3rd", id: "water-walk" },
            { name: "Wind Wall", level: "3rd", id: "wind-wall" },
            { name: "Revivify", level: "3rd", id: "revivify" },
            { name: "Sleet Storm", level: "3rd", id: "sleet" },
            { name: "Plant Growth", level: "3rd", id: "plant" },
            { name: "Conjure Minor Elementals", level: "4th", id: "minor-elementals" },
            { name: "Control Water", level: "4th", id: "control-water" },
            { name: "Elemental Bane", level: "4th", id: "elemental-bane" },
            { name: "Ice Storm", level: "4th", id: "ice-storm" },
            { name: "Stoneskin", level: "4th", id: "stoneskin" },
            { name: "Wall of Fire", level: "4th", id: "wall-fire" },
            { name: "Watery Sphere", level: "4th", id: "watery-sphere" },
            { name: "Fire Shield", level: "4th", id: "fire-shield" },
            { name: "Divination (R)", level: "4th", id: "divination" },
            { name: "Grasping Vine", level: "4th", id: "grasping" },
            { name: "Cone of Cold", level: "5th", id: "cone-cold" },
            { name: "Conjure Elemental", level: "5th", id: "conjure-elemental" },
            { name: "Control Winds", level: "5th", id: "control-winds" },
            { name: "Wall of Stone", level: "5th", id: "wall-stone" },
            { name: "Mass Cure Wounds", level: "5th", id: "mass-cure" },
            { name: "Transmute Rock", level: "5th", id: "transmute" }
        ];

        // Spell descriptions database
        const spellDescriptions = {
            "gust": {
                name: "Gust",
                level: "Cantrip",
                school: "Transmutation",
                castingTime: "1 action",
                range: "30 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "You seize the air and compel it to create one of the following effects at a point you can see within range:<br><br>• One Medium or smaller creature that you choose must succeed on a Strength saving throw or be pushed up to 5 feet away from you.<br>• You create a small blast of air capable of moving one object that is neither held nor carried and that weighs no more than 5 pounds. The object is pushed up to 10 feet away from you. It isn't pushed with enough force to cause damage.<br>• You create a harmless sensory effect using air, such as causing leaves to rustle, wind to slam shutters closed, or your clothing to ripple in a breeze."
            },
            "sorcerous-burst": {
                name: "Sorcerous Burst",
                level: "Cantrip",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "You cast sorcerous energy at one creature or object within range. Make a ranged attack roll against the target. On a hit, the target takes 1d8 damage of a type you choose: Acid, Cold, Fire, Lightning, Poison, Psychic, or Thunder.<br><br>If you roll an 8 on a d8 for this spell, you can roll another d8, and add it to the damage. When you cast this spell, the maximum number of these d8s you can add to the spell's damage equals your spellcasting ability modifier.<br><br><strong>Cantrip Upgrade.</strong> The damage increases by 1d8 when you reach levels 5 (2d8), 11 (3d8), and 17 (4d8)."
            },
            "speak-animals": {
                name: "Speak with Animals",
                level: "1st-level",
                school: "Divination (ritual)",
                castingTime: "1 action",
                range: "Self",
                components: "V, S",
                duration: "10 minutes",
                description: "You gain the ability to comprehend and verbally communicate with beasts for the duration. The knowledge and awareness of many beasts is limited by their intelligence, but at minimum, beasts can give you information about nearby locations and monsters, including whatever they can perceive or have perceived within the past day. You might be able to persuade a beast to perform a small favor for you, at the GM's discretion."
            },
            "find-familiar": {
                name: "Find Familiar",
                level: "1st-level",
                school: "Conjuration (ritual)",
                castingTime: "1 hour",
                range: "10 feet",
                components: "V, S, M (10 gp worth of charcoal, incense, and herbs that must be consumed by fire in a brass brazier)",
                duration: "Instantaneous",
                description: "You gain the service of a familiar, a spirit that takes an animal form you choose: bat, cat, crab, frog (toad), hawk, lizard, octopus, owl, poisonous snake, fish (quipper), rat, raven, sea horse, spider, or weasel. Appearing in an unoccupied space within range, the familiar has the statistics of the chosen form, though it is a celestial, fey, or fiend (your choice) instead of a beast.<br><br>Your familiar acts independently of you, but it always obeys your commands. In combat, it rolls its own initiative and acts on its own turn. A familiar can't attack, but it can take other actions as normal.<br><br>When the familiar drops to 0 hit points, it disappears, leaving behind no physical form. It reappears after you cast this spell again."
            },
            "mold-earth": {
                name: "Mold Earth",
                level: "Cantrip",
                school: "Transmutation",
                castingTime: "1 action",
                range: "30 feet",
                components: "S",
                duration: "Instantaneous or 1 hour",
                description: "You choose a portion of dirt or stone that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways:<br><br>• If you target an area of loose earth, you can instantaneously excavate it, move it along the ground, and deposit it up to 5 feet away. This movement doesn't have enough force to cause damage.<br>• You cause shapes, colors, or both to appear on the dirt or stone, spelling out words, creating images, or shaping patterns. The changes last for 1 hour.<br>• If the dirt or stone you target is on the ground, you cause it to become difficult terrain. Alternatively, you can cause the ground to become normal terrain if it is already difficult terrain. This change lasts for 1 hour.<br><br>If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
            },
            "elemental-armor": {
                name: "Elemental Armor",
                level: "1st-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (a shard of elemental crystal)",
                duration: "8 hours",
                description: "You weave elemental energy into a protective barrier around yourself. Until the spell ends, your base AC becomes 13 plus your Dexterity modifier. The spell ends early if you don armor."
            },
            "earthen-grasp": {
                name: "Maximilian's Earthen Grasp",
                level: "2nd-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "30 feet",
                components: "V, S, M (a miniature hand sculpted from clay)",
                duration: "Concentration, up to 1 minute",
                description: "You choose a 5-foot-square unoccupied space on the ground that you can see within range. A Medium hand made from compacted soil rises there and reaches for one creature you can see within 5 feet of it. The target must make a Strength saving throw. On a failed save, the target takes 2d6 bludgeoning damage and is restrained for the spell's duration.<br><br>As an action, you can cause the hand to crush the restrained target, which must make a Strength saving throw. It takes 2d6 bludgeoning damage on a failed save, or half as much damage on a successful one.<br><br>To break out, the restrained target can use its action to make a Strength check against your spell save DC. On a success, the target escapes and is no longer restrained by the hand.<br><br>As an action, you can cause the hand to reach for a different creature or to move to a different unoccupied space within range. The hand releases a restrained target if you do either."
            },
            "fireball": {
                name: "Fireball",
                level: "3rd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "150 feet",
                components: "V, S, M (a tiny ball of bat guano and sulfur)",
                duration: "Instantaneous",
                description: "A bright streak flashes from your pointing finger to a point you choose within range and then blossoms with a low roar into an explosion of flame. Each creature in a 20-foot-radius sphere centered on that point must make a Dexterity saving throw. A target takes 8d6 fire damage on a failed save, or half as much damage on a successful one.<br><br>The fire spreads around corners. It ignites flammable objects in the area that aren't being worn or carried.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d6 for each slot level above 3rd."
            },
            "elemental-mantle": {
                name: "Conjure Elemental Mantle",
                level: "4th-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "Self",
                components: "V, S",
                duration: "Concentration, up to 10 minutes",
                description: "You conjure a mantle of elemental energy that swirls around you in a 10-foot Emanation for the duration of the spell. Whenever the Emanation enters the space of a creature you can see and whenever a creature you can see enters the Emanation or ends its turn there, you can force that creature to make a Wisdom saving throw. The creature takes 5d8 Fire, Cold, Lightning, or Thunder damage (your choice when you cast the spell) on a failed save or half as much damage on a successful one. A creature makes this save only once per turn.<br><br>In addition, you can take the Disengage action as a Bonus Action for the spell's duration.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 4."
            },
            "maelstrom": {
                name: "Maelstrom",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (paper or leaf in the shape of a funnel)",
                duration: "Concentration, up to 1 minute",
                description: "A mass of 5-foot-deep water appears and swirls in a 30-foot radius centered on a point you can see within range. The point must be on the ground or in a body of water. Until the spell ends, that area is difficult terrain, and any creature that starts its turn there must succeed on a Strength saving throw or take 6d6 bludgeoning damage and be pulled 10 feet toward the center."
            },
            "absorb": {
                name: "Absorb Elements",
                level: "1st-level",
                school: "Abjuration",
                castingTime: "1 reaction, which you take when you take acid, cold, fire, lightning, or thunder damage",
                range: "Self",
                components: "S",
                duration: "1 round",
                description: "The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type, and the spell ends.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by 1d6 for each slot level above 1st."
            },
            "spring": {
                name: "Spring's Touch",
                level: "1st-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "30 feet",
                components: "V, S, M (a drop of pure spring water)",
                duration: "Instantaneous",
                description: "You channel the purifying essence of a sacred spring toward a creature within range. The target regains 2d6 + your spellcasting ability modifier hit points and is moved up to 10 feet in a direction of your choice (this movement doesn't provoke opportunity attacks).<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the healing increases by 2d6 for each slot level above 1st."
            },
            "cure": {
                name: "Cure Wounds",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S",
                duration: "Instantaneous",
                description: "A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier. This spell has no effect on undead or constructs.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the healing increases by 1d8 for each slot level above 1st."
            },
            "healing-word": {
                name: "Healing Word",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 bonus action",
                range: "60 feet",
                components: "V",
                duration: "Instantaneous",
                description: "A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier. This spell has no effect on undead or constructs.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the healing increases by 1d4 for each slot level above 1st."
            },
            "detect": {
                name: "Detect Magic",
                level: "1st-level",
                school: "Divination (ritual)",
                castingTime: "1 action",
                range: "Self",
                components: "V, S",
                duration: "Concentration, up to 10 minutes",
                description: "For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.<br><br>The spell can penetrate most barriers, but it is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt."
            },
            "warding": {
                name: "Warding Wind",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self",
                components: "V",
                duration: "Concentration, up to 10 minutes",
                description: "A strong wind (20 miles per hour) blows around you in a 10-foot radius and moves with you, remaining centered on you. The wind lasts for the spell's duration.<br><br>The wind has the following effects:<br>• It deafens you and other creatures in its area.<br>• It extinguishes unprotected flames in its area that are torch-sized or smaller.<br>• It hedges out vapor, gas, and fog that can be dispersed by strong wind.<br>• The area is difficult terrain for creatures other than you.<br>• The attack rolls of ranged weapon attacks have disadvantage if the attacks pass in or out of the wind."
            },
            "pass": {
                name: "Pass without Trace",
                level: "2nd-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (ashes from a burned leaf of mistletoe and a sprig of spruce)",
                duration: "Concentration, up to 1 hour",
                description: "A veil of shadows and silence radiates from you, masking you and your companions from detection. For the duration, each creature you choose within 30 feet of you (including you) has a +10 bonus to Dexterity (Stealth) checks and can't be tracked except by magical means. A creature that receives this bonus leaves behind no tracks or other traces of its passage."
            },
            "hold": {
                name: "Hold Person",
                level: "2nd-level",
                school: "Enchantment",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S, M (a small, straight piece of iron)",
                duration: "Concentration, up to 1 minute",
                description: "Choose a humanoid that you can see within range. The target must succeed on a Wisdom saving throw or be paralyzed for the duration. At the end of each of its turns, the target can make another Wisdom saving throw. On a success, the spell ends on the target.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, you can target one additional humanoid for each slot level above 2nd. The humanoids must be within 30 feet of each other when you target them."
            },
            "enhance": {
                name: "Enhance Ability",
                level: "2nd-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S, M (fur or a feather from a beast)",
                duration: "Concentration, up to 1 hour",
                description: "You touch a creature and bestow upon it a magical enhancement. Choose one of the following effects; the target gains that effect until the spell ends.<br><br><strong>Bear's Endurance.</strong> The target has advantage on Constitution checks. It also gains 2d6 temporary hit points, which are lost when the spell ends.<br><strong>Bull's Strength.</strong> The target has advantage on Strength checks, and their carrying capacity doubles.<br><strong>Cat's Grace.</strong> The target has advantage on Dexterity checks. It also doesn't take damage from falling 20 feet or less if it isn't incapacitated.<br><strong>Eagle's Splendor.</strong> The target has advantage on Charisma checks.<br><strong>Fox's Cunning.</strong> The target has advantage on Intelligence checks.<br><strong>Owl's Wisdom.</strong> The target has advantage on Wisdom checks.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd."
            },
            "aura": {
                name: "Aura of Vitality",
                level: "3rd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self (30-foot radius)",
                components: "V",
                duration: "Concentration, up to 1 minute",
                description: "Healing energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. You can use a bonus action to cause one creature in the aura (including you) to regain 2d6 hit points."
            },
            "revivify": {
                name: "Revivify",
                level: "3rd-level",
                school: "Necromancy",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S, M (diamonds worth 300 gp, which the spell consumes)",
                duration: "Instantaneous",
                description: "You touch a creature that has died within the last minute. That creature returns to life with 1 hit point. This spell can't return to life a creature that has died of old age, nor can it restore any missing body parts."
            },
            "sleet": {
                name: "Sleet Storm",
                level: "3rd-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "150 feet",
                components: "V, S, M (a pinch of dust and a few drops of water)",
                duration: "Concentration, up to 1 minute",
                description: "Until the spell ends, freezing rain and sleet fall in a 20-foot-tall cylinder with a 40-foot radius centered on a point you choose within range. The area is heavily obscured, and exposed flames in the area are doused.<br><br>The ground in the area is covered with slick ice, making it difficult terrain. When a creature enters the spell's area for the first time on a turn or starts its turn there, it must make a Dexterity saving throw. On a failed save, it falls prone.<br><br>If a creature starts its turn in the spell's area and is concentrating on a spell, the creature must make a successful Constitution saving throw against your spell save DC or lose concentration."
            },
            "plant": {
                name: "Plant Growth",
                level: "3rd-level",
                school: "Transmutation",
                castingTime: "1 action or 8 hours",
                range: "150 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "This spell channels vitality into plants within a specific area. There are two possible uses for the spell, granting either immediate or long-term benefits.<br><br>If you cast this spell using 1 action, choose a point within range. All normal plants in a 100-foot radius centered on that point become thick and overgrown. A creature moving through the area must spend 4 feet of movement for every 1 foot it moves.<br><br>You can exclude one or more areas of any size within the spell's area from being affected.<br><br>If you cast this spell over 8 hours, you enrich the land. All plants in a half-mile radius centered on a point within range become enriched for 1 year. The plants yield twice the normal amount of food when harvested."
            },
            "fire-shield": {
                name: "Fire Shield",
                level: "4th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (a bit of phosphorus or a firefly)",
                duration: "10 minutes",
                description: "Thin and wispy flames wreathe your body for the duration, shedding bright light in a 10-foot radius and dim light for an additional 10 feet. You can end the spell early by using an action to dismiss it.<br><br>The flames provide you with a warm shield or a chill shield, as you choose. The warm shield grants you resistance to cold damage, and the chill shield grants you resistance to fire damage.<br><br>In addition, whenever a creature within 5 feet of you hits you with a melee attack, the shield erupts with flame. The attacker takes 2d8 fire damage from a warm shield, or 2d8 cold damage from a cold shield."
            },
            "divination": {
                name: "Divination",
                level: "4th-level",
                school: "Divination (ritual)",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (incense and a sacrificial offering appropriate to your religion, together worth at least 25 gp, which the spell consumes)",
                duration: "Instantaneous",
                description: "Your magic and an offering put you in contact with a god or a god's servants. You ask a single question concerning a specific goal, event, or activity to occur within 7 days. The GM offers a truthful reply. The reply might be a short phrase, a cryptic rhyme, or an omen.<br><br>The spell doesn't take into account any possible circumstances that might change the outcome, such as the casting of additional spells or the loss or gain of a companion.<br><br>If you cast the spell two or more times before finishing your next long rest, there is a cumulative 25 percent chance for each casting after the first that you get a random reading. The GM makes this roll in secret."
            },
            "grasping": {
                name: "Grasping Vine",
                level: "4th-level",
                school: "Conjuration",
                castingTime: "1 bonus action",
                range: "30 feet",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: "You conjure a vine that sprouts from the ground in an unoccupied space of your choice that you can see within range. When you cast this spell, you can direct the vine to lash out at a creature within 30 feet of it that you can see. That creature must succeed on a Dexterity saving throw or be pulled 20 feet directly toward the vine.<br><br>Until the spell ends, you can direct the vine to lash out at the same creature or another one as a bonus action on each of your turns."
            },
            "mass-cure": {
                name: "Mass Cure Wounds",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "A wave of healing energy washes out from a point of your choice within range. Choose up to six creatures in a 30-foot-radius sphere centered on that point. Each target regains hit points equal to 3d8 + your spellcasting ability modifier. This spell has no effect on undead or constructs.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 6th level or higher, the healing increases by 1d8 for each slot level above 5th."
            },
            "transmute": {
                name: "Transmute Rock",
                level: "5th-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (clay and water)",
                duration: "Until dispelled",
                description: "You choose an area of stone or mud that you can see that fits within a 40-foot cube and is within range, and choose one of the following effects.<br><br><strong>Transmute Rock to Mud.</strong> Nonmagical rock of any sort in the area becomes an equal volume of thick, flowing mud that remains for the spell's duration. The ground in the spell's area becomes muddy enough that creatures can sink into it. Each foot that a creature moves through the mud costs 4 feet of movement, and any creature on the ground when you cast the spell must make a Strength saving throw. A creature must also make the saving throw when it moves into the area for the first time on a turn or ends its turn there. On a failed save, a creature sinks into the mud and is restrained, though it can use an action to end the restrained condition on itself by pulling itself free of the mud. If you cast the spell on a ceiling, the mud falls. Any creature under the mud when it falls must make a Dexterity saving throw. A creature takes 4d8 bludgeoning damage on a failed save, or half as much damage on a successful one.<br><br><strong>Transmute Mud to Rock.</strong> Nonmagical mud or quicksand in the area no more than 10 feet deep transforms into soft stone for the spell's duration. Any creature in the mud when it transforms must make a Dexterity saving throw. On a successful save, a creature is shunted safely to the surface in an unoccupied space. On a failed save, a creature becomes restrained by the rock. A restrained creature, or another creature within reach, can use an action to try to break the rock by succeeding on a DC 20 Strength check or by dealing damage to it. The rock has AC 15 and 25 hit points, and it is immune to poison and psychic damage."
            },
            "control-flames": {
                name: "Control Flames",
                level: "Cantrip",
                school: "Transmutation",
                castingTime: "1 action",
                range: "60 feet",
                components: "S",
                duration: "Instantaneous or 1 hour",
                description: "You choose nonmagical flame that you can see within range and that fits within a 5-foot cube. You affect it in one of the following ways:<br><br>• You instantaneously expand the flame 5 feet in one direction, provided that wood or other fuel is present in the new location.<br>• You instantaneously extinguish the flames within the cube.<br>• You double or halve the area of bright light and dim light cast by the flame, change its color, or both. The change lasts for 1 hour.<br>• You cause simple shapes—such as the vague form of a creature, an inanimate object, or a location—to appear within the flames and animate as you like. The shapes last for 1 hour.<br><br>If you cast this spell multiple times, you can have up to three non-instantaneous effects created by it active at a time, and you can dismiss such an effect as an action."
            },
            "produce-flame": {
                name: "Produce Flame",
                level: "Cantrip",
                school: "Conjuration",
                castingTime: "1 bonus action",
                range: "Self",
                components: "V, S",
                duration: "10 minutes",
                description: "A flickering flame appears in your hand and remains there for the duration. While there, the flame emits no heat and ignites nothing, and it sheds Bright Light in a 20-foot radius and Dim Light for an additional 20 feet. The spell ends if you cast it again.<br><br>Until the spell ends, you can take a Magic action to hurl fire at a creature or an object within 60 feet of you. Make a ranged spell attack. On a hit, the target takes 1d8 Fire damage.<br><br><strong>Cantrip Upgrade.</strong> The damage increases by 1d8 when you reach levels 5 (2d8), 11 (3d8), and 17 (4d8)."
            },
            "ray-frost": {
                name: "Ray of Frost",
                level: "Cantrip",
                school: "Evocation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "A frigid beam of blue-white light streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, it takes 1d8 Cold damage, and its Speed is reduced by 10 feet until the start of your next turn.<br><br><strong>Cantrip Upgrade.</strong> The damage increases by 1d8 when you reach levels 5 (2d8), 11 (3d8), and 17 (4d8)."
            },
            "shape-water": {
                name: "Shape Water",
                level: "Cantrip",
                school: "Transmutation",
                castingTime: "1 action",
                range: "30 feet",
                components: "S",
                duration: "Instantaneous or 1 hour",
                description: "You choose an area of water that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways:<br><br>• You instantaneously move or otherwise change the flow of the water as you direct, up to 5 feet in any direction. This movement doesn't have enough force to cause damage.<br>• You cause the water to form into simple shapes and animate at your direction. This change lasts for 1 hour.<br>• You change the water's color or opacity. The water must be changed in the same way throughout. This change lasts for 1 hour.<br>• You freeze the water, provided that there are no creatures in it. The water unfreezes in 1 hour.<br><br>If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
            },
            "shocking-grasp": {
                name: "Shocking Grasp",
                level: "Cantrip",
                school: "Evocation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S",
                duration: "Instantaneous",
                description: "Lightning springs from you to a creature that you try to touch. Make a melee spell attack against the target. On a hit, the target takes 1d8 Lightning damage, and it can't make Opportunity Attacks until the start of its next turn.<br><br><strong>Cantrip Upgrade.</strong> The damage increases by 1d8 when you reach levels 5 (2d8), 11 (3d8), and 17 (4d8)."
            },
            "burning-hands": {
                name: "Burning Hands",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self",
                components: "V, S",
                duration: "Instantaneous",
                description: "A thin sheet of flames shoots forth from you. Each creature in a 15-foot Cone makes a Dexterity saving throw, taking 3d6 Fire damage on a failed save or half as much damage on a successful one.<br><br>Flammable objects in the Cone that aren't being worn or carried start burning.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d6 for each spell slot level above 1."
            },
            "chromatic-orb": {
                name: "Chromatic Orb",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "90 feet",
                components: "V, S, M (a diamond worth 50+ GP)",
                duration: "Instantaneous",
                description: "You hurl an orb of energy at a target within range. Choose Acid, Cold, Fire, Lightning, Poison, or Thunder for the type of orb you create, and then make a ranged spell attack against the target. On a hit, the target takes 3d8 damage of the chosen type.<br><br>If you roll the same number on two or more of the d8s, the orb leaps to a different target of your choice within 30 feet of the target. Make an attack roll against the new target, and make a new damage roll. The orb can't leap again unless you cast the spell with a level 2+ spell slot.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 1. The orb can leap a maximum number of times equal to the level of the slot expended, and a creature can be targeted only once by each casting of this spell."
            },
            "create-water": {
                name: "Create or Destroy Water",
                level: "1st-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "30 feet",
                components: "V, S, M (a mix of water and sand)",
                duration: "Instantaneous",
                description: "You do one of the following:<br><br><strong>Create Water.</strong> You create up to 10 gallons of clean water within range in an open container. Alternatively, the water falls as rain in a 30-foot Cube within range, extinguishing exposed flames there.<br><br><strong>Destroy Water.</strong> You destroy up to 10 gallons of water in an open container within range. Alternatively, you destroy fog in a 30-foot Cube within range.<br><br><strong>Using a Higher-Level Spell Slot.</strong> You create or destroy 10 additional gallons of water, or the size of the Cube increases by 5 feet, for each spell slot level above 1."
            },
            "earth-shield": {
                name: "Earth Shield",
                level: "1st-level",
                school: "Abjuration",
                castingTime: "1 reaction, which you take when you are hit by an attack or targeted by the magic missile spell",
                range: "Self",
                components: "V, S",
                duration: "1 round",
                description: "You conjure an earthen shield which forms around your arm. For the duration, you gain 15 temporary hit points, including against the triggering attack.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you gain an additional 10 temporary hit points for each slot level above 1st."
            },
            "earth-tremor": {
                name: "Earth Tremor",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "10 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "You cause a tremor in the ground within range. Each creature other than you in that area must make a Dexterity saving throw. On a failed save, a creature takes 1d6 bludgeoning damage and is knocked prone. If the ground in that area is loose earth or stone, it becomes difficult terrain until cleared, with each 5-foot-diameter portion requiring at least 1 minute to clear by hand.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
            },
            "feather-fall": {
                name: "Feather Fall",
                level: "1st-level",
                school: "Transmutation",
                castingTime: "Reaction, which you take when you or a creature you can see within 60 feet of you falls",
                range: "60 feet",
                components: "V, M (a small feather or piece of down)",
                duration: "1 minute",
                description: "Choose up to five falling creatures within range. A falling creature's rate of descent slows to 60 feet per round until the spell ends. If a creature lands before the spell ends, the creature takes no damage from the fall, and the spell ends for that creature."
            },
            "hellish-rebuke": {
                name: "Hellish Rebuke",
                level: "1st-level",
                school: "Evocation",
                castingTime: "Reaction, which you take in response to taking damage from a creature that you can see within 60 feet of yourself",
                range: "60 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "The creature that damaged you is momentarily surrounded by green flames. It makes a Dexterity saving throw, taking 2d10 Fire damage on a failed save or half as much damage on a successful one.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d10 for each spell slot level above 1."
            },
            "searing-smite": {
                name: "Searing Smite",
                level: "1st-level",
                school: "Evocation",
                castingTime: "Bonus action, which you take immediately after hitting a target with a Melee weapon or an Unarmed Strike",
                range: "Self",
                components: "V",
                duration: "1 minute",
                description: "As you hit the target, it takes an extra 1d6 Fire damage from the attack. At the start of each of its turns until the spell ends, the target takes 1d6 Fire damage and then makes a Constitution saving throw. On a failed save, the spell continues. On a successful save, the spell ends.<br><br><strong>Using a Higher-Level Spell Slot.</strong> All the damage increases by 1d6 for each spell slot level above 1."
            },
            "thunderous-smite": {
                name: "Thunderous Smite",
                level: "1st-level",
                school: "Evocation",
                castingTime: "Bonus action, which you take immediately after hitting a target with a Melee weapon or an Unarmed Strike",
                range: "Self",
                components: "V",
                duration: "Instantaneous",
                description: "Your strike rings with thunder that is audible within 300 feet of you, and the target takes an extra 2d6 Thunder damage from the attack. Additionally, if the target is a creature, it must succeed on a Strength saving throw or be pushed 10 feet away from you and have the Prone condition.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d6 for each spell slot level above 1."
            },
            "witch-bolt": {
                name: "Witch Bolt",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S, M (a twig struck by lightning)",
                duration: "Concentration, up to 1 minute",
                description: "A beam of crackling energy lances toward a creature within range, forming a sustained arc of lightning between you and the target. Make a ranged spell attack against it. On a hit, the target takes 2d12 Lightning damage.<br><br>On each of your subsequent turns, you can take a Bonus Action to deal 1d12 Lightning damage to the target automatically, even if the first attack missed.<br><br>The spell ends if the target is ever outside the spell's range or if it has Total Cover from you.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The initial damage increases by 1d12 for each spell slot level above 1."
            },
            "zephyr-strike": {
                name: "Zephyr Strike",
                level: "1st-level",
                school: "Transmutation",
                castingTime: "1 bonus action",
                range: "Self",
                components: "V",
                duration: "Concentration, up to 1 minute",
                description: "You move like the wind. Until the spell ends, your movement doesn't provoke opportunity attacks.<br><br>Once before the spell ends, you can give yourself advantage on one weapon attack roll on your turn. That attack deals an extra 1d8 force damage on a hit. Whether you hit or miss, your walking speed increases by 30 feet until the end of that turn."
            },
            "scorcher": {
                name: "Aganazzar's Scorcher",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "30 feet",
                components: "V, S, M (a red dragon's scale)",
                duration: "Instantaneous",
                description: "A line of roaring flame 30 feet long and 5 feet wide emanates from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 3d8 fire damage on a failed save, or half as much damage on a successful one.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
            },
            "continual-flame": {
                name: "Continual Flame",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S, M (ruby dust worth 50+ GP, which the spell consumes)",
                duration: "Until dispelled",
                description: "A flame springs from an object that you touch. The effect casts Bright Light in a 20-foot radius and Dim Light for an additional 20 feet. It looks like a regular flame, but it creates no heat and consumes no fuel. The flame can be covered or hidden but not smothered or quenched."
            },
            "dragon-breath": {
                name: "Dragon's Breath",
                level: "2nd-level",
                school: "Transmutation",
                castingTime: "1 bonus action",
                range: "Touch",
                components: "V, S, M (a hot pepper)",
                duration: "Concentration, up to 1 minute",
                description: "You touch one willing creature, and choose Acid, Cold, Fire, Lightning, or Poison. Until the spell ends, the target can take a Magic action to exhale a 15-foot Cone. Each creature in that area makes a Dexterity saving throw, taking 3d6 damage of the chosen type on a failed save or half as much damage on a successful one.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d6 for each spell slot level above 2."
            },
            "flame-blade": {
                name: "Flame Blade",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 bonus action",
                range: "Self",
                components: "V, S, M (a sumac leaf)",
                duration: "Concentration, up to 10 minutes",
                description: "You evoke a fiery blade in your free hand. The blade is similar in size and shape to a scimitar, and it lasts for the duration. If you let go of the blade, it disappears, but you can evoke it again as a Bonus Action.<br><br>As a Magic action, you can make a melee spell attack with the fiery blade. On a hit, the target takes Fire damage equal to 3d6 plus your spellcasting ability modifier.<br><br>The flaming blade sheds Bright Light in a 10-foot radius and Dim Light for an additional 10 feet.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d6 for each spell slot level above 2."
            },
            "flaming-sphere": {
                name: "Flaming Sphere",
                level: "2nd-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S, M (a ball of wax)",
                duration: "Concentration, up to 1 minute",
                description: "You create a 5-foot-diameter sphere of fire in an unoccupied space on the ground within range. It lasts for the duration. Any creature that ends its turn within 5 feet of the sphere makes a Dexterity saving throw, taking 2d6 Fire damage on a failed save or half as much damage on a successful one.<br><br>As a Bonus Action, you can move the sphere up to 30 feet, rolling it along the ground. If you move the sphere into a creature's space, that creature makes the save against the sphere, and the sphere stops moving for the turn.<br><br>When you move the sphere, you can direct it over barriers up to 5 feet tall and jump it across pits up to 10 feet wide. Flammable objects that aren't being worn or carried start burning if touched by the sphere, and it sheds Bright Light in a 20-foot radius and Dim Light for an additional 20 feet.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d6 for each spell slot level above 2."
            },
            "heat-metal": {
                name: "Heat Metal",
                level: "2nd-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S, M (a piece of iron and a flame)",
                duration: "Concentration, up to 1 minute",
                description: "Choose a manufactured metal object, such as a metal weapon or a suit of Heavy or Medium metal armor, that you can see within range. You cause the object to glow red-hot. Any creature in physical contact with the object takes 2d8 Fire damage when you cast the spell. Until the spell ends, you can take a Bonus Action on each of your later turns to deal this damage again if the object is within range.<br><br>If a creature is holding or wearing the object and takes the damage from it, the creature must succeed on a Constitution saving throw or drop the object if it can. If it doesn't drop the object, it has Disadvantage on attack rolls and ability checks until the start of your next turn.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 2."
            },
            "binding-ice": {
                name: "Rime's Binding Ice",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self (30-foot cone)",
                components: "S, M (a vial of meltwater)",
                duration: "Instantaneous",
                description: "A burst of cold energy emanates from you in a 30-foot cone. Each creature in that area must make a Constitution saving throw. On a failed save, a creature takes 3d8 cold damage and is hindered by ice formations for 1 minute, or until it or another creature within reach of it uses an action to break away the ice. A creature hindered by ice has its speed reduced to 0. On a successful save, a creature takes half as much damage and isn't hindered by ice.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, increase the cold damage by 1d8 for each slot level above 2nd."
            },
            "scorching-ray": {
                name: "Scorching Ray",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "You hurl three fiery rays. You can hurl them at one target within range or at several. Make a ranged spell attack for each ray. On a hit, the target takes 2d6 Fire damage.<br><br><strong>Using a Higher-Level Spell Slot.</strong> You create one additional ray for each spell slot level above 2."
            },
            "snowball": {
                name: "Snilloc's Snowball Swarm",
                level: "2nd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "90 feet",
                components: "V, S, M (a piece of ice or a small white rock chip)",
                duration: "Instantaneous",
                description: "A flurry of magic snowballs erupts from a point you choose within range. Each creature in a 5-foot-radius sphere centered on that point must make a Dexterity saving throw. A creature takes 3d6 cold damage on a failed save, or half as much damage on a successful one.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd."
            },
            "stride": {
                name: "Ashardalon's Stride",
                level: "3rd-level",
                school: "Transmutation",
                castingTime: "1 bonus action",
                range: "Self",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: "The billowing flames of a dragon blast from your feet, granting you explosive speed. For the duration, your speed increases by 20 feet and moving doesn't provoke opportunity attacks.<br><br>When you move within 5 feet of a creature or an object that isn't being worn or carried, it takes 1d6 fire damage from your trail of heat. A creature or object can take this damage only once during a turn.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, increase your speed by 5 feet for each spell slot level above 3rd. The spell deals an additional 1d6 fire damage for each slot level above 3rd."
            },
            "elemental-weapon": {
                name: "Elemental Weapon",
                level: "3rd-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S",
                duration: "Concentration, up to 1 hour",
                description: "A nonmagical weapon you touch becomes a magic weapon. Choose one of the following damage types: Acid, Cold, Fire, Lightning, or Thunder. For the duration, the weapon has a +1 bonus to attack rolls and deals an extra 1d4 damage of the chosen type when it hits.<br><br><strong>Using a Higher-Level Spell Slot.</strong> If you use a level 5-6 spell slot, the bonus to attack rolls increases to +2, and the extra damage increases to 2d4. If you use a level 7+ spell slot, the bonus increases to +3, and the extra damage increases to 3d4."
            },
            "erupting-earth": {
                name: "Erupting Earth",
                level: "3rd-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (a piece of obsidian)",
                duration: "Instantaneous",
                description: "Choose a point you can see on the ground within range. A fountain of churned earth and stone erupts in a 20-foot cube centered on that point. Each creature in that area must make a Dexterity saving throw. A creature takes 3d12 bludgeoning damage on a failed save, or half as much damage on a successful one. Additionally, the ground in that area becomes difficult terrain until cleared. Each 5-foot-square portion of the area requires at least 1 minute to clear by hand.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d12 for each slot level above 3rd."
            },
            "fly": {
                name: "Fly",
                level: "3rd-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S, M (a feather)",
                duration: "Concentration, up to 10 minutes",
                description: "You touch a willing creature. For the duration, the target gains a Fly Speed of 60 feet and can hover. When the spell ends, the target falls if it is still aloft unless it can stop the fall.<br><br><strong>Using a Higher-Level Spell Slot.</strong> You can target one additional creature for each spell slot level above 3."
            },
            "lightning-bolt": {
                name: "Lightning Bolt",
                level: "3rd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (a bit of fur and a crystal rod)",
                duration: "Instantaneous",
                description: "A stroke of lightning forming a 100-foot-long, 5-foot-wide Line blasts out from you in a direction you choose. Each creature in the Line makes a Dexterity saving throw, taking 8d6 Lightning damage on a failed save or half as much damage on a successful one.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d6 for each spell slot level above 3."
            },
            "protection-energy": {
                name: "Protection from Energy",
                level: "3rd-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S",
                duration: "Concentration, up to 1 hour",
                description: "For the duration, the willing creature you touch has Resistance to one damage type of your choice: Acid, Cold, Fire, Lightning, or Thunder."
            },
            "riptides": {
                name: "Riptides",
                level: "3rd-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (a conch shell)",
                duration: "Instantaneous",
                description: "You summon waves of water that flow outward in a 30-foot emanation. Choose up to 6 creatures within the emanation, each creature regains 2d6 + your spellcasting ability modifier hit points and is moved up to 10 feet in a direction of your choice (this movement doesn't provoke opportunity attacks).<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the healing increases by 1d6 for each slot level above 3rd."
            },
            "tidal-wave": {
                name: "Tidal Wave",
                level: "3rd-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (a drop of water)",
                duration: "Instantaneous",
                description: "You conjure up a wave of water that crashes down on an area within range. The area can be up to 30 feet long, up to 10 feet wide, and up to 10 feet tall. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 4d8 bludgeoning damage and is knocked prone. On a successful save, a creature takes half as much damage and isn't knocked prone. The water then spreads out across the ground in all directions, extinguishing unprotected flames in its area and within 30 feet of it, and then it vanishes."
            },
            "wall-sand": {
                name: "Wall of Sand",
                level: "3rd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "90 feet",
                components: "V, S, M (a handful of sand)",
                duration: "Concentration, up to 10 minutes",
                description: "You create a wall of swirling sand on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 10 feet thick, and it vanishes when the spell ends. It blocks line of sight but not movement. A creature is blinded while in the wall's space and must spend 3 feet of movement for every 1 foot it moves there."
            },
            "wall-water": {
                name: "Wall of Water",
                level: "3rd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S, M (a drop of water)",
                duration: "Concentration, up to 10 minutes",
                description: "You create a wall of water on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 1 foot thick, or you can make a ringed wall up to 20 feet in diameter, 20 feet high, and 1 foot thick. The wall vanishes when the spell ends. The wall's space is difficult terrain.<br><br>Any ranged weapon attack that enters the wall's space has disadvantage on the attack roll, and fire damage is halved if the fire effect passes through the wall to reach its target. Spells that deal cold damage that pass through the wall cause the area of the wall they pass through to freeze solid (at least a 5-foot-square section is frozen). Each 5-foot-square frozen section has AC 5 and 15 hit points. Reducing a frozen section to 0 hit points destroys it. When a section is destroyed, the wall's water doesn't fill it."
            },
            "water-breathing": {
                name: "Water Breathing",
                level: "3rd-level",
                school: "Transmutation (ritual)",
                castingTime: "1 action or Ritual",
                range: "30 feet",
                components: "V, S, M (a short reed)",
                duration: "24 hours",
                description: "This spell grants up to ten willing creatures of your choice within range the ability to breathe underwater until the spell ends. Affected creatures also retain their normal mode of respiration."
            },
            "water-walk": {
                name: "Water Walk",
                level: "3rd-level",
                school: "Transmutation (ritual)",
                castingTime: "1 action or Ritual",
                range: "30 feet",
                components: "V, S, M (a piece of cork)",
                duration: "1 hour",
                description: "This spell grants the ability to move across any liquid surface—such as water, acid, mud, snow, quicksand, or lava—as if it were harmless solid ground (creatures crossing molten lava can still take damage from the heat). Up to ten willing creatures of your choice within range gain this ability for the duration.<br><br>An affected target must take a Bonus Action to pass from the liquid's surface into the liquid itself and vice versa, but if the target falls into the liquid, the target passes through the surface into the liquid below."
            },
            "wind-wall": {
                name: "Wind Wall",
                level: "3rd-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (a fan and a feather)",
                duration: "Concentration, up to 1 minute",
                description: "A wall of strong wind rises from the ground at a point you choose within range. You can make the wall up to 50 feet long, 15 feet high, and 1 foot thick. You can shape the wall in any way you choose so long as it makes one continuous path along the ground. The wall lasts for the duration.<br><br>When the wall appears, each creature in its area makes a Strength saving throw, taking 4d8 Bludgeoning damage on a failed save or half as much damage on a successful one.<br><br>The strong wind keeps fog, smoke, and other gases at bay. Small or smaller flying creatures or objects can't pass through the wall. Loose, lightweight materials brought into the wall fly upward. Arrows, bolts, and other ordinary projectiles launched at targets behind the wall are deflected upward and miss automatically. Boulders hurled by Giants or siege engines, and similar projectiles, are unaffected. Creatures in gaseous form can't pass through it."
            },
            "minor-elementals": {
                name: "Conjure Minor Elementals",
                level: "4th-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "Self",
                components: "V, S",
                duration: "Concentration, up to 10 minutes",
                description: "You conjure spirits from the Elemental Planes that flit around you in a 15-foot Emanation for the duration. Until the spell ends, any attack you make deals an extra 2d8 damage when you hit a creature in the Emanation. This damage is Acid, Cold, Fire, or Lightning (your choice when you make the attack).<br><br>In addition, the ground in the Emanation is Difficult Terrain for your enemies.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 4."
            },
            "control-water": {
                name: "Control Water",
                level: "4th-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "300 feet",
                components: "V, S, M (a mixture of water and dust)",
                duration: "Concentration, up to 10 minutes",
                description: "Until the spell ends, you control any water inside an area you choose that is a Cube up to 100 feet on a side, using one of the following effects. As a Magic action on your later turns, you can repeat the same effect or choose a different one.<br><br><strong>Flood.</strong> You cause the water level of all standing water in the area to rise by as much as 20 feet. If you choose an area in a large body of water, you instead create a 20-foot tall wave that travels from one side of the area to the other and then crashes. Any Huge or smaller vehicles in the wave's path are carried with it to the other side. Any Huge or smaller vehicles struck by the wave have a 25 percent chance of capsizing.<br><br>The water level remains elevated until the spell ends or you choose a different effect. If this effect produced a wave, the wave repeats on the start of your next turn while the flood effect lasts.<br><br><strong>Part Water.</strong> You part water in the area and create a trench. The trench extends across the spell's area, and the separated water forms a wall to either side. The trench remains until the spell ends or you choose a different effect. The water then slowly fills in the trench over the course of the next round until the normal water level is restored.<br><br><strong>Redirect Flow.</strong> You cause flowing water in the area to move in a direction you choose, even if the water has to flow over obstacles, up walls, or in other unlikely directions. The water in the area moves as you direct it, but once it moves beyond the spell's area, it resumes its flow based on the terrain. The water continues to move in the direction you chose until the spell ends or you choose a different effect.<br><br><strong>Whirlpool.</strong> You cause a whirlpool to form in the center of the area, which must be at least 50 feet square and 25 feet deep. The whirlpool lasts until you choose a different effect or the spell ends. The whirlpool is 5 feet wide at the base, up to 50 feet wide at the top, and 25 feet tall. Any creature in the water and within 25 feet of the whirlpool is pulled 10 feet toward it. When a creature enters the whirlpool for the first time on a turn or ends its turn there, it makes a Strength saving throw. On a failed save, the creature takes 2d8 Bludgeoning damage. On a successful save, the creature takes half as much damage. A creature can swim away from the whirlpool only if it first takes an action to pull away and succeeds on a Strength (Athletics) check against your spell save DC."
            },
            "elemental-bane": {
                name: "Elemental Bane",
                level: "4th-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "90 feet",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: "Choose one creature you can see within range, and choose one of the following damage types: acid, cold, fire, lightning, or thunder. The target must succeed on a Constitution saving throw or be affected by the spell for its duration. The first time each turn the affected target takes damage of the chosen type, the target takes an extra 2d6 damage of that type. Moreover, the target loses any resistance to that damage type until the spell ends.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th. The creatures must be within 30 feet of each other when you target them."
            },
            "ice-storm": {
                name: "Ice Storm",
                level: "4th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "300 feet",
                components: "V, S, M (a mitten)",
                duration: "Instantaneous",
                description: "Hail falls in a 20-foot-radius, 40-foot-high Cylinder centered on a point within range. Each creature in the Cylinder makes a Dexterity saving throw. A creature takes 2d10 Bludgeoning damage and 4d6 Cold damage on a failed save or half as much damage on a successful one.<br><br>Hailstones turn ground in the Cylinder into Difficult Terrain until the end of your next turn.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The Bludgeoning damage increases by 1d10 for each spell slot level above 4."
            },
            "stoneskin": {
                name: "Stoneskin",
                level: "4th-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "Touch",
                components: "V, S, M (diamond dust worth 100+ GP, which the spell consumes)",
                duration: "Concentration, up to 1 hour",
                description: "Until the spell ends, one willing creature you touch has Resistance to Bludgeoning, Piercing, and Slashing damage."
            },
            "storm-sphere": {
                name: "Storm Sphere",
                level: "4th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "150 feet",
                components: "V, S",
                duration: "Concentration, up to 1 minute",
                description: "A 20-foot-radius sphere of whirling air springs into existence, centered on a point you choose within range. The sphere remains for the spell's duration. Each creature in the sphere when it appears or that ends its turn there must succeed on a Strength saving throw or take 2d6 bludgeoning damage. The sphere's space is difficult terrain.<br><br>Until the spell ends, you can use a bonus action on each of your turns to cause a bolt of lightning to leap from the center of the sphere toward one creature you choose within 60 feet of the center. Make a ranged spell attack. You have advantage on the attack roll if the target is in the sphere. On a hit, the target takes 4d6 lightning damage.<br><br>Creatures within 30 feet of the sphere have disadvantage on Wisdom (Perception) checks made to listen.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 5th level or higher, the damage for each of its effects increases by 1d6 for each slot level above 4th."
            },
            "wall-fire": {
                name: "Wall of Fire",
                level: "4th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (a piece of charcoal)",
                duration: "Concentration, up to 1 minute",
                description: "You create a wall of fire on a solid surface within range. You can make the wall up to 60 feet long, 20 feet high, and 1 foot thick, or a ringed wall up to 20 feet in diameter, 20 feet high, and 1 foot thick. The wall is opaque and lasts for the duration.<br><br>When the wall appears, each creature in its area makes a Dexterity saving throw, taking 5d8 Fire damage on a failed save or half as much damage on a successful one.<br><br>One side of the wall, selected by you when you cast this spell, deals 5d8 Fire damage to each creature that ends its turn within 10 feet of that side or inside the wall. A creature takes the same damage when it enters the wall for the first time on a turn or ends its turn there. The other side of the wall deals no damage.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 4."
            },
            "watery-sphere": {
                name: "Watery Sphere",
                level: "4th-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "90 feet",
                components: "V, S, M (a droplet of water)",
                duration: "Concentration, up to 1 minute",
                description: "You conjure up a sphere of water with a 5-foot radius at a point you can see within range. The sphere can hover but no more than 10 feet off the ground. The sphere remains for the spell's duration.<br><br>Any creature in the sphere's space must make a Strength saving throw. On a successful save, a creature is ejected from that space to the nearest unoccupied space of the creature's choice outside the sphere. A Huge or larger creature succeeds on the saving throw automatically, and a Large or smaller creature can choose to fail it. On a failed save, a creature is restrained by the sphere and is engulfed by the water. At the end of each of its turns, a restrained target can repeat the saving throw, ending the effect on itself on a success.<br><br>The sphere can restrain as many as four Medium or smaller creatures or one Large creature. If the sphere restrains a creature that causes it to exceed this capacity, a random creature that was already restrained by the sphere falls out of it and lands prone in a space within 5 feet of it.<br><br>As an action, you can move the sphere up to 30 feet in a straight line. If it moves over a pit, a cliff, or other drop-off, it safely descends until it is hovering 10 feet above the ground. Any creature restrained by the sphere moves with it. You can ram the sphere into creatures, forcing them to make the saving throw.<br><br>When the spell ends, the sphere falls to the ground and extinguishes all normal flames within 30 feet of it. Any creature restrained by the sphere is knocked prone in the space where it falls. The water then vanishes."
            },
            "cone-cold": {
                name: "Cone of Cold",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (a small crystal or glass cone)",
                duration: "Instantaneous",
                description: "You unleash a blast of cold air. Each creature in a 60-foot Cone originating from you makes a Constitution saving throw, taking 8d8 Cold damage on a failed save or half as much damage on a successful one. A creature killed by this spell becomes a frozen statue until it thaws.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 5."
            },
            "conjure-elemental": {
                name: "Conjure Elemental",
                level: "5th-level",
                school: "Conjuration",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S",
                duration: "Concentration, up to 10 minutes",
                description: "You conjure a Large, intangible spirit from the Elemental Planes that appears in an unoccupied space within range. Choose the spirit's element, which determines its damage type: air (Lightning), earth (Thunder), fire (Fire), or water (Cold). The spirit lasts for the duration.<br><br>Whenever a creature you can see enters the spirit's space or starts its turn within 5 feet of the spirit, you can force that creature to make a Dexterity saving throw if the spirit has no creature Restrained. On failed save, the target takes 8d8 damage of the spirit's type, and the target has the Restrained condition until the spell ends. At the start of each of its turns, the Restrained target repeats the save. On a failed save, the target takes 4d8 damage of the spirit's type. On a successful save, the target isn't Restrained by the spirit.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The damage increases by 1d8 for each spell slot level above 5."
            },
            "control-winds": {
                name: "Control Winds",
                level: "5th-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "300 feet",
                components: "V, S",
                duration: "Concentration, up to 1 hour",
                description: "You take control of the air in a 100-foot cube that you can see within range. Choose one of the following effects when you cast the spell. The effect lasts for the spell's duration, unless you use your action on a later turn to switch to a different effect. You can also use your action to temporarily halt the effect or to restart one you've halted.<br><br><strong>Gusts.</strong> A wind picks up within the cube, continually blowing in a horizontal direction you designate. You choose the intensity of the wind: calm, moderate, or strong. If the wind is moderate or strong, ranged weapon attacks that pass through it or that are made against targets within the cube have disadvantage on their attack rolls. If the wind is strong, any creature moving against the wind must spend 1 extra foot of movement for each foot moved.<br><br><strong>Downdraft.</strong> You cause a sustained blast of strong wind to blow downward from the top of the cube. Ranged weapon attacks that pass through the cube or that are made against targets within it have disadvantage on their attack rolls. A creature must make a Strength saving throw if it flies into the cube for the first time on a turn or starts its turn there flying. On a failed save, the creature is knocked prone.<br><br><strong>Updraft.</strong> You cause a sustained updraft within the cube, rising upward from the cube's bottom side. Creatures that end a fall within the cube take only half damage from the fall. When a creature in the cube makes a vertical jump, the creature can jump up to 10 feet higher than normal."
            },
            "flame-strike": {
                name: "Flame Strike",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S, M (a pinch of sulfur)",
                duration: "Instantaneous",
                description: "A vertical column of brilliant fire roars down from above. Each creature in a 10-foot-radius, 40-foot-high Cylinder centered on a point within range makes a Dexterity saving throw, taking 5d6 Fire damage and 5d6 Radiant damage on a failed save or half as much damage on a successful one.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The Fire damage and the Radiant damage increase by 1d6 for each spell slot level above 5."
            },
            "immolation": {
                name: "Immolation",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "90 feet",
                components: "V",
                duration: "Concentration, up to 1 minute",
                description: "Flames wreathe one creature you can see within range. The target must make a Dexterity saving throw. It takes 8d6 fire damage on a failed save, or half as much damage on a successful one. On a failed save, the target also burns for the spell's duration. The burning target sheds bright light in a 30-foot radius and dim light for an additional 30 feet. At the end of each of its turns, the target repeats the saving throw. It takes 4d6 fire damage on a failed save, and the spell ends on a successful one. These magical flames can't be extinguished by nonmagical means.<br><br>If damage from this spell kills a target, the target is turned to ash."
            },
            "wall-stone": {
                name: "Wall of Stone",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (a cube of granite)",
                duration: "Concentration, up to 10 minutes",
                description: "A nonmagical wall of solid stone springs into existence at a point you choose within range. The wall is 6 inches thick and is composed of ten 10-foot-by-10-foot panels. Each panel must be contiguous with another panel. Alternatively, you can create 10-foot-by-20-foot panels that are only 3 inches thick.<br><br>If the wall cuts through a creature's space when it appears, the creature is pushed to one side of the wall (you choose which side). If a creature would be surrounded on all sides by the wall (or the wall and another solid surface), that creature can make a Dexterity saving throw. On a success, it can use its Reaction to move up to its Speed so that it is no longer enclosed by the wall.<br><br>The wall can have any shape you desire, though it can't occupy the same space as a creature or object. The wall doesn't need to be vertical or rest on a firm foundation. It must, however, merge with and be solidly supported by existing stone. Thus, you can use this spell to bridge a chasm or create a ramp.<br><br>If you create a span greater than 20 feet in length, you must halve the size of each panel to create supports. You can crudely shape the wall to create battlements and the like.<br><br>The wall is an object made of stone that can be damaged and thus breached. Each panel has AC 15 and 30 Hit Points per inch of thickness, and it has Immunity to Poison and Psychic damage. Reducing a panel to 0 Hit Points destroys it and might cause connected panels to collapse at the DM's discretion.<br><br>If you maintain your Concentration on this spell for its full duration, the wall becomes permanent and can't be dispelled. Otherwise, the wall disappears when the spell ends."
            },
            "mage-hand": {
                name: "Mage Hand",
                level: "Cantrip",
                school: "Conjuration",
                castingTime: "1 action",
                range: "30 feet",
                components: "V, S",
                duration: "1 minute",
                description: "A spectral, floating hand appears at a point you choose within range. The hand lasts for the duration. The hand vanishes if it is ever more than 30 feet away from you or if you cast this spell again.<br><br>When you cast the spell, you can use the hand to manipulate an object, open an unlocked door or container, stow or retrieve an item from an open container, or pour the contents out of a vial.<br><br>As a Magic action on your later turns, you can control the hand thus again. As part of that action, you can move the hand up to 30 feet.<br><br>The hand can't attack, activate magic items, or carry more than 10 pounds."
            },
            "message": {
                name: "Message",
                level: "Cantrip",
                school: "Transmutation",
                castingTime: "1 action",
                range: "120 feet",
                components: "S, M (a copper wire)",
                duration: "1 round",
                description: "You point toward a creature within range and whisper a message. The target (and only the target) hears the message and can reply in a whisper that only you can hear.<br><br>You can cast this spell through solid objects if you are familiar with the target and know it is beyond the barrier. Magical silence; 1 foot of stone, metal, or wood; or a thin sheet of lead blocks the spell."
            },
            "mind-sliver": {
                name: "Mind Sliver",
                level: "Cantrip",
                school: "Enchantment",
                castingTime: "1 action",
                range: "60 feet",
                components: "V",
                duration: "Instantaneous",
                description: "You try to temporarily sliver the mind of one creature you can see within range. The target must succeed on an Intelligence saving throw or take 1d6 Psychic damage and subtract 1d4 from the next saving throw it makes before the end of your next turn.<br><br><strong>Cantrip Upgrade.</strong> The damage increases by 1d6 when you reach levels 5 (2d6), 11 (3d6), and 17 (4d6)."
            },
            "magic-missile": {
                name: "Magic Missile",
                level: "1st-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "You create three glowing darts of magical force. Each dart strikes a creature of your choice that you can see within range. A dart deals 1d4 + 1 Force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The spell creates one more dart for each spell slot level above 1."
            },
            "shield": {
                name: "Shield",
                level: "1st-level",
                school: "Abjuration",
                castingTime: "Reaction, which you take when you are hit by an attack roll or targeted by the Magic Missile spell",
                range: "Self",
                components: "V, S",
                duration: "1 round",
                description: "An imperceptible barrier of magical force protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from Magic Missile."
            },
            "see-invisibility": {
                name: "See Invisibility",
                level: "2nd-level",
                school: "Divination",
                castingTime: "1 action",
                range: "Self",
                components: "V, S, M (a pinch of talc)",
                duration: "1 hour",
                description: "For the duration, you see creatures and objects that have the Invisible condition as if they were visible, and you can see into the Ethereal Plane. Creatures and objects there appear ghostly."
            },
            "silence": {
                name: "Silence",
                level: "2nd-level",
                school: "Illusion",
                castingTime: "1 action or Ritual",
                range: "120 feet",
                components: "V, S",
                duration: "Concentration, up to 10 minutes",
                description: "For the duration, no sound can be created within or pass through a 20-foot-radius Sphere centered on a point you choose within range. Any creature or object entirely inside the Sphere has Immunity to Thunder damage, and creatures have the Deafened condition while entirely inside it. Casting a spell that includes a Verbal component is impossible there."
            },
            "tashas-mind-whip": {
                name: "Tasha's Mind Whip",
                level: "2nd-level",
                school: "Enchantment",
                castingTime: "1 action",
                range: "90 feet",
                components: "V",
                duration: "1 round",
                description: "You psychically lash out at one creature you can see within range. The target must make an Intelligence saving throw. On a failed save, the target takes 3d6 psychic damage, and it can't take a reaction until the end of its next turn. Moreover, on its next turn, it must choose whether it gets a move, an action, or a bonus action; it gets only one of the three. On a successful save, the target takes half as much damage and suffers none of the spell's other effects.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd. The creatures must be within 30 feet of each other when you target them."
            },
            "counterspell": {
                name: "Counterspell",
                level: "3rd-level",
                school: "Abjuration",
                castingTime: "Reaction, which you take when you see a creature within 60 feet of yourself casting a spell with Verbal, Somatic, or Material components",
                range: "60 feet",
                components: "S",
                duration: "Instantaneous",
                description: "You attempt to interrupt a creature in the process of casting a spell. The creature makes a Constitution saving throw. On a failed save, the spell dissipates with no effect, and the action, Bonus Action, or Reaction used to cast it is wasted. If that spell was cast with a spell slot, the slot isn't expended."
            },
            "dispel-magic": {
                name: "Dispel Magic",
                level: "3rd-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "Choose one creature, object, or magical effect within range. Any ongoing spell of level 3 or lower on the target ends. For each ongoing spell of level 4 or higher on the target, make an ability check using your spellcasting ability (DC 10 plus that spell's level). On a successful check, the spell ends.<br><br><strong>Using a Higher-Level Spell Slot.</strong> You automatically end a spell on the target if the spell's level is equal to or less than the level of the spell slot you use."
            },
            "intellect-fortress": {
                name: "Intellect Fortress",
                level: "3rd-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "30 feet",
                components: "V",
                duration: "Concentration, up to 1 hour",
                description: "For the duration, you or one willing creature you can see within range has resistance to psychic damage, as well as advantage on Intelligence, Wisdom, and Charisma saving throws.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, you can target one additional creature for each slot level above 3rd. The creatures must be within 30 feet of each other when you target them."
            },
            "amplify-magic": {
                name: "Amplify Magic",
                level: "4th-level",
                school: "Evocation",
                castingTime: "Reaction, which you take when you see a creature within 60 feet of yourself casting a spell with a verbal, somatic, or material components",
                range: "60 feet",
                components: "S",
                duration: "Instantaneous",
                description: "You channel raw magical energy to amplify a spell being cast. Choose one spell being cast by a creature within range. The spell is amplified in the following ways:<br><br>• Attack rolls made by the spell have advantage.<br>• Targets have disadvantage on saving throws made to resist the effects of the spell.<br>• When the spell would normally roll one or more dice to restore Hit Points or grant temporary Hit Points, don't roll those dice; instead use the highest number possible for each die."
            },
            "raulothims-psychic-lance": {
                name: "Raulothim's Psychic Lance",
                level: "4th-level",
                school: "Enchantment",
                castingTime: "1 action",
                range: "120 feet",
                components: "V",
                duration: "Instantaneous",
                description: "You unleash a shimmering lance of psychic power from your forehead at a creature that you can see within range. Alternatively, you can utter a creature's name. If the named target is within range, it becomes the spell's target even if you can't see it. If the named target isn't within range, the lance dissipates without effect.<br><br>The target must make an Intelligence saving throw. On a failed save, the target takes 7d6 psychic damage and is incapacitated until the start of your next turn. On a successful save, the creature takes half as much damage and isn't incapacitated.<br><br><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 5th level or higher, the damage increases by 1d6 for each slot level above 4th."
            },
            "staggering-smite": {
                name: "Staggering Smite",
                level: "4th-level",
                school: "Enchantment",
                castingTime: "Bonus action, which you take immediately after hitting a creature with a Melee weapon or an Unarmed Strike",
                range: "Self",
                components: "V",
                duration: "Instantaneous",
                description: "The target takes an extra 4d6 Psychic damage from the attack, and the target must succeed on a Wisdom saving throw or have the Stunned condition until the end of your next turn.<br><br><strong>Using a Higher-Level Spell Slot.</strong> The extra damage increases by 1d6 for each spell slot level above 4."
            },
            "circle-of-power": {
                name: "Circle of Power",
                level: "5th-level",
                school: "Abjuration",
                castingTime: "1 action",
                range: "Self",
                components: "V",
                duration: "Concentration, up to 10 minutes",
                description: "An aura radiates from you in a 30-foot Emanation for the duration. While in the aura, you and your allies have Advantage on saving throws against spells and other magical effects. When an affected creature makes a saving throw against a spell or magical effect that allows a save to take only half damage, it takes no damage if it succeeds on the save."
            },
            "synaptic-static": {
                name: "Synaptic Static",
                level: "5th-level",
                school: "Enchantment",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S",
                duration: "Instantaneous",
                description: "You cause psychic energy to erupt at a point within range. Each creature in a 20-foot-radius Sphere centered on that point makes an Intelligence saving throw, taking 8d6 Psychic damage on a failed save or half as much damage on a successful one.<br><br>On a failed save, a target also has muddled thoughts for 1 minute. During that time, it subtracts 1d6 from all its attack rolls and ability checks, as well as any Constitution saving throws to maintain Concentration. The target makes an Intelligence saving throw at the end of each of its turns, ending the effect on itself on a success."
            },
            "telekinesis": {
                name: "Telekinesis",
                level: "5th-level",
                school: "Transmutation",
                castingTime: "1 action",
                range: "60 feet",
                components: "V, S",
                duration: "Concentration, up to 10 minutes",
                description: "You gain the ability to move or manipulate creatures or objects by thought. When you cast the spell and as a Magic action on your later turns before the spell ends, you can exert your will on one creature or object that you can see within range, causing the appropriate effect below. You can affect the same target round after round or choose a new one at any time. If you switch targets, the prior target is no longer affected by the spell.<br><br><strong>Creature.</strong> You can try to move a Huge or smaller creature. The target must succeed on a Strength saving throw, or you move it up to 30 feet in any direction within the spell's range. Until the end of your next turn, the creature has the Restrained condition, and if you lift it into the air, it is suspended there. It falls at the end of your next turn unless you use this option on it again and it fails the save.<br><br><strong>Object.</strong> You can try to move a Huge or smaller object. If the object isn't being worn or carried, you automatically move it up to 30 feet in any direction within the spell's range.<br><br>If the object is worn or carried by a creature, that creature must succeed on a Strength saving throw, or you pull the object away and move it up to 30 feet in any direction within the spell's range.<br><br>You can exert fine control on objects with your telekinetic grip, such as manipulating a simple tool, opening a door or a container, stowing or retrieving an item from an open container, or pouring the contents from a vial."
            },
            "wall-of-force": {
                name: "Wall of Force",
                level: "5th-level",
                school: "Evocation",
                castingTime: "1 action",
                range: "120 feet",
                components: "V, S, M (a shard of glass)",
                duration: "Concentration, up to 10 minutes",
                description: "An Invisible wall of force springs into existence at a point you choose within range. The wall appears in any orientation you choose, as a horizontal or vertical barrier or at an angle. It can be free floating or resting on a solid surface. You can form it into a hemispherical dome or a globe with a radius of up to 10 feet, or you can shape a flat surface made up of ten 10-foot-by-10-foot panels. Each panel must be contiguous with another panel. In any form, the wall is 1/4 inch thick and lasts for the duration. If the wall cuts through a creature's space when it appears, the creature is pushed to one side of the wall (you choose which side).<br><br>Nothing can physically pass through the wall. It is immune to all damage and can't be dispelled by Dispel Magic. A Disintegrate spell destroys the wall instantly, however. The wall also extends into the Ethereal Plane and blocks ethereal travel through the wall."
            }
        };

        // Complete spell lists for swapping
        const aetherSpellList = {
            'C': [
                { name: "Mage Hand", level: "C", id: "mage-hand" },
                { name: "Message", level: "C", id: "message" },
                { name: "Mind Sliver", level: "C", id: "mind-sliver" }
            ],
            '1st': [
                { name: "Detect Magic", level: "1st", id: "detect" },
                { name: "Magic Missile", level: "1st", id: "magic-missile" },
                { name: "Shield", level: "1st", id: "shield" }
            ],
            '2nd': [
                { name: "See Invisibility", level: "2nd", id: "see-invisibility" },
                { name: "Silence", level: "2nd", id: "silence" },
                { name: "Tasha's Mind Whip", level: "2nd", id: "tashas-mind-whip" }
            ],
            '3rd': [
                { name: "Counterspell", level: "3rd", id: "counterspell" },
                { name: "Dispel Magic", level: "3rd", id: "dispel-magic" },
                { name: "Intellect Fortress", level: "3rd", id: "intellect-fortress" }
            ],
            '4th': [
                { name: "Amplify Magic", level: "4th", id: "amplify-magic" },
                { name: "Raulothim's Psychic Lance", level: "4th", id: "raulothims-psychic-lance" },
                { name: "Staggering Smite", level: "4th", id: "staggering-smite" }
            ],
            '5th': [
                { name: "Circle of Power", level: "5th", id: "circle-of-power" },
                { name: "Synaptic Static", level: "5th", id: "synaptic-static" },
                { name: "Telekinesis", level: "5th", id: "telekinesis" },
                { name: "Wall of Force", level: "5th", id: "wall-of-force" }
            ]
        };

        const elementalistSpellList = {
            'C': [
                { name: "Control Flames", level: "C", id: "control-flames" },
                { name: "Gust", level: "C", id: "gust" },
                { name: "Mold Earth", level: "C", id: "mold-earth" },
                { name: "Produce Flame", level: "C", id: "produce-flame" },
                { name: "Ray of Frost", level: "C", id: "ray-frost" },
                { name: "Shape Water", level: "C", id: "shape-water" },
                { name: "Shocking Grasp", level: "C", id: "shocking-grasp" },
                { name: "Sorcerous Burst", level: "C", id: "sorcerous-burst" }
            ],
            '1st': [
                { name: "Absorb Elements", level: "1st", id: "absorb" },
                { name: "Burning Hands", level: "1st", id: "burning-hands" },
                { name: "Chromatic Orb", level: "1st", id: "chromatic-orb" },
                { name: "Create or Destroy Water", level: "1st", id: "create-water" },
                { name: "Earth Shield", level: "1st", id: "earth-shield" },
                { name: "Earth Tremor", level: "1st", id: "earth-tremor" },
                { name: "Elemental Armor", level: "1st", id: "elemental-armor" },
                { name: "Feather Fall", level: "1st", id: "feather-fall" },
                { name: "Hellish Rebuke", level: "1st", id: "hellish-rebuke" },
                { name: "Searing Smite", level: "1st", id: "searing-smite" },
                { name: "Spring's Touch", level: "1st", id: "spring" },
                { name: "Thunderous Smite", level: "1st", id: "thunderous-smite" },
                { name: "Witch Bolt", level: "1st", id: "witch-bolt" },
                { name: "Zephyr Strike", level: "1st", id: "zephyr-strike" }
            ],
            '2nd': [
                { name: "Aganazzar's Scorcher", level: "2nd", id: "scorcher" },
                { name: "Continual Flame", level: "2nd", id: "continual-flame" },
                { name: "Dragon's Breath", level: "2nd", id: "dragon-breath" },
                { name: "Flame Blade", level: "2nd", id: "flame-blade" },
                { name: "Flaming Sphere", level: "2nd", id: "flaming-sphere" },
                { name: "Heat Metal", level: "2nd", id: "heat-metal" },
                { name: "Maximilian's Earthen Grasp", level: "2nd", id: "earthen-grasp" },
                { name: "Rime's Binding Ice", level: "2nd", id: "binding-ice" },
                { name: "Scorching Ray", level: "2nd", id: "scorching-ray" },
                { name: "Snilloc's Snowball Swarm", level: "2nd", id: "snowball" },
                { name: "Warding Wind", level: "2nd", id: "warding" }
            ],
            '3rd': [
                { name: "Ashardalon's Stride", level: "3rd", id: "stride" },
                { name: "Elemental Weapon", level: "3rd", id: "elemental-weapon" },
                { name: "Erupting Earth", level: "3rd", id: "erupting-earth" },
                { name: "Fireball", level: "3rd", id: "fireball" },
                { name: "Fly", level: "3rd", id: "fly" },
                { name: "Lightning Bolt", level: "3rd", id: "lightning-bolt" },
                { name: "Protection from Energy", level: "3rd", id: "protection-energy" },
                { name: "Riptides", level: "3rd", id: "riptides" },
                { name: "Sleet Storm", level: "3rd", id: "sleet" },
                { name: "Tidal Wave", level: "3rd", id: "tidal-wave" },
                { name: "Wall of Sand", level: "3rd", id: "wall-sand" },
                { name: "Wall of Water", level: "3rd", id: "wall-water" },
                { name: "Water Breathing", level: "3rd", id: "water-breathing" },
                { name: "Water Walk", level: "3rd", id: "water-walk" },
                { name: "Wind Wall", level: "3rd", id: "wind-wall" }
            ],
            '4th': [
                { name: "Conjure Elemental Mantle", level: "4th", id: "elemental-mantle" },
                { name: "Conjure Minor Elementals", level: "4th", id: "minor-elementals" },
                { name: "Control Water", level: "4th", id: "control-water" },
                { name: "Elemental Bane", level: "4th", id: "elemental-bane" },
                { name: "Fire Shield", level: "4th", id: "fire-shield" },
                { name: "Ice Storm", level: "4th", id: "ice-storm" },
                { name: "Stoneskin", level: "4th", id: "stoneskin" },
                { name: "Storm Sphere", level: "4th", id: "storm-sphere" },
                { name: "Wall of Fire", level: "4th", id: "wall-fire" },
                { name: "Watery Sphere", level: "4th", id: "watery-sphere" }
            ],
            '5th': [
                { name: "Cone of Cold", level: "5th", id: "cone-cold" },
                { name: "Conjure Elemental", level: "5th", id: "conjure-elemental" },
                { name: "Control Winds", level: "5th", id: "control-winds" },
                { name: "Flame Strike", level: "5th", id: "flame-strike" },
                { name: "Immolation", level: "5th", id: "immolation" },
                { name: "Maelstrom", level: "5th", id: "maelstrom" },
                { name: "Transmute Rock", level: "5th", id: "transmute" },
                { name: "Wall of Stone", level: "5th", id: "wall-stone" }
            ]
        };

        // Initialize
        function init() {
            loadSavedData();
            updateStats();
            updateHP();
            renderWildShape();
            renderSpellSlots();
            renderSpells();
        }

        function updateStats() {
            const level = parseInt(document.getElementById('level').value);
            const wisdom = parseInt(document.getElementById('wisdom').value);
            const dexterity = parseInt(document.getElementById('dexterity').value);
            
            character.level = level;
            character.wisdom = wisdom;
            character.dexterity = dexterity;

            // Calculate derived stats
            const wisMod = Math.floor((wisdom - 10) / 2);
            const dexMod = Math.floor((dexterity - 10) / 2);
            const profBonus = Math.ceil(level / 4) + 1;
            
            // Pendant bonus
            const pendantBonus = character.pendantLevel === 'Exalted' ? 3 : 
                                character.pendantLevel === 'Awakened' ? 2 : 1;
            
            const spellDC = 8 + profBonus + wisMod + pendantBonus;
            
            // AC: 13 + DEX + WIS if Elemental Armor, or 10 + DEX + WIS if not
            const baseAC = character.elementalArmor ? 13 : 10;
            const ac = baseAC + dexMod + wisMod;

            document.getElementById('wis-mod').textContent = wisMod >= 0 ? `+${wisMod}` : wisMod;
            document.getElementById('dex-mod').textContent = dexMod >= 0 ? `+${dexMod}` : dexMod;
            document.getElementById('prof-bonus').textContent = `+${profBonus}`;
            document.getElementById('spell-dc').textContent = spellDC;
            document.getElementById('ac').textContent = ac;

            // Update max prepared spells based on table
            const maxPreparedByLevel = {
                1: 4, 2: 5, 3: 6, 4: 7, 5: 9, 6: 10, 7: 11, 8: 12, 9: 14,
                10: 15, 11: 16, 12: 16, 13: 17, 14: 17, 15: 18, 16: 18,
                17: 19, 18: 20, 19: 21, 20: 22
            };
            document.getElementById('max-prepared').textContent = maxPreparedByLevel[level] || 4;

            // Update HP based on formula: 13 + (10 * (level - 1))
            const newMaxHP = 13 + (10 * (level - 1));
            const hpDiff = newMaxHP - character.maxHP;
            character.maxHP = newMaxHP;
            character.currentHP = Math.min(character.currentHP + hpDiff, character.maxHP);

            // Update Wild Shape charges based on level
            let wildShapeMax = 2;
            if (level >= 20) wildShapeMax = 4;
            else if (level >= 6) wildShapeMax = 3;
            
            character.wildShapeCharges.max = wildShapeMax;
            if (character.wildShapeCharges.current > wildShapeMax) {
                character.wildShapeCharges.current = wildShapeMax;
            }

            // Update spell slots based on level
            updateSpellSlotsByLevel(level);
            
            updateHP();
            renderWildShape();
            renderSpells(); // Re-render spells after level change
            saveData();
        }

        function updateSpellSlotsByLevel(level) {
            // Spell slots per level based on Druid table
            const slots = {
                1: { 1: 2, 2: 3, 3: 4, 4: 4, 5: 4, 6: 4, 7: 4, 8: 4, 9: 4, 10: 4, 11: 4, 12: 4, 13: 4, 14: 4, 15: 4, 16: 4, 17: 4, 18: 4, 19: 4, 20: 4 },
                2: { 3: 2, 4: 3, 5: 3, 6: 3, 7: 3, 8: 3, 9: 3, 10: 3, 11: 3, 12: 3, 13: 3, 14: 3, 15: 3, 16: 3, 17: 3, 18: 3, 19: 3, 20: 3 },
                3: { 5: 2, 6: 3, 7: 3, 8: 3, 9: 3, 10: 3, 11: 3, 12: 3, 13: 3, 14: 3, 15: 3, 16: 3, 17: 3, 18: 3, 19: 3, 20: 3 },
                4: { 7: 1, 8: 2, 9: 3, 10: 3, 11: 3, 12: 3, 13: 3, 14: 3, 15: 3, 16: 3, 17: 3, 18: 3, 19: 3, 20: 3 },
                5: { 9: 1, 10: 2, 11: 2, 12: 2, 13: 2, 14: 2, 15: 2, 16: 2, 17: 2, 18: 2, 19: 2, 20: 2 },
                6: { 11: 1, 12: 1, 13: 1, 14: 1, 15: 1, 16: 1, 17: 1, 18: 1, 19: 1, 20: 2 },
                7: { 13: 1, 14: 1, 15: 1, 16: 1, 17: 1, 18: 1, 19: 1, 20: 1 },
                8: { 15: 1, 16: 1, 17: 1, 18: 1, 19: 1, 20: 1 },
                9: { 17: 1, 18: 1, 19: 1, 20: 1 }
            };

            for (let slotLevel = 1; slotLevel <= 9; slotLevel++) {
                if (!character.spellSlots[slotLevel]) {
                    character.spellSlots[slotLevel] = { current: 0, max: 0 };
                }

                if (slots[slotLevel] && slots[slotLevel][level]) {
                    const newMax = slots[slotLevel][level];
                    const oldMax = character.spellSlots[slotLevel].max;
                    
                    // If gaining new slots, add the difference to current
                    if (newMax > oldMax) {
                        const difference = newMax - oldMax;
                        character.spellSlots[slotLevel].current = Math.min(
                            character.spellSlots[slotLevel].current + difference,
                            newMax
                        );
                    } else if (newMax < character.spellSlots[slotLevel].current) {
                        // If losing slots, reduce current if it exceeds new max
                        character.spellSlots[slotLevel].current = newMax;
                    }
                    
                    character.spellSlots[slotLevel].max = newMax;
                } else {
                    // No slots at this level
                    character.spellSlots[slotLevel].max = 0;
                    character.spellSlots[slotLevel].current = 0;
                }
            }
            
            // Re-render spell slots after updating
            renderSpellSlots();
        }

        function toggleElementalArmor() {
            character.elementalArmor = !character.elementalArmor;
            const display = document.getElementById('elemental-armor');
            if (character.elementalArmor) {
                display.textContent = '✓';
                display.style.color = '#2ecc71'; // Green for active
            } else {
                display.textContent = '✗';
                display.style.color = '#e74c3c'; // Red for inactive
            }
            updateStats();
        }

        function cyclePendantLevel() {
            const levels = ['Dormant', 'Awakened', 'Exalted'];
            const currentIndex = levels.indexOf(character.pendantLevel);
            const nextIndex = (currentIndex + 1) % levels.length;
            character.pendantLevel = levels[nextIndex];
            
            const display = document.getElementById('pendant-level');
            display.textContent = character.pendantLevel;
            
            // Color based on level
            const colors = {
                'Dormant': '#95a5a6',
                'Awakened': '#3498db',
                'Exalted': '#f39c12'
            };
            display.style.color = colors[character.pendantLevel];
            
            updateStats();
        }

        function updateHP() {
            document.getElementById('current-hp').textContent = character.currentHP;
            document.getElementById('max-hp').textContent = character.maxHP;
        }

        function modifyHP(amount) {
            if (amount === 0) {
                const input = document.getElementById('hp-input');
                amount = parseInt(input.value) || 0;
                input.value = '';
            }
            
            character.currentHP = Math.max(0, Math.min(character.maxHP, character.currentHP + amount));
            updateHP();
            saveData();
        }

        function renderWildShape() {
            const container = document.getElementById('wild-shape-charges');
            container.innerHTML = '';
            
            for (let i = 0; i < character.wildShapeCharges.max; i++) {
                const charge = document.createElement('div');
                charge.className = 'charge';
                if (i < character.wildShapeCharges.current) {
                    charge.classList.add('active');
                }
                charge.onclick = () => toggleCharge(i);
                container.appendChild(charge);
            }
        }

        function toggleCharge(index) {
            if (index < character.wildShapeCharges.current) {
                character.wildShapeCharges.current = index;
            } else if (index === character.wildShapeCharges.current) {
                character.wildShapeCharges.current++;
            }
            renderWildShape();
            saveData();
        }

        function renderSpellSlots() {
            const container = document.getElementById('spell-slots-container');
            container.innerHTML = '';

            for (let level = 1; level <= 9; level++) {
                if (character.spellSlots[level] && character.spellSlots[level].max > 0) {
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'slot-level';
                    
                    const label = document.createElement('label');
                    label.textContent = `Nivel ${level}:`;
                    slotDiv.appendChild(label);

                    const slotsContainer = document.createElement('div');
                    slotsContainer.className = 'slots';

                    for (let i = 0; i < character.spellSlots[level].max; i++) {
                        const slot = document.createElement('div');
                        slot.className = 'slot';
                        if (i < character.spellSlots[level].current) {
                            slot.classList.add('active');
                        }
                        slot.onclick = () => toggleSlot(level, i);
                        slotsContainer.appendChild(slot);
                    }

                    slotDiv.appendChild(slotsContainer);
                    container.appendChild(slotDiv);
                }
            }
        }

        function toggleSlot(level, index) {
            if (index < character.spellSlots[level].current) {
                character.spellSlots[level].current = index;
            } else if (index === character.spellSlots[level].current) {
                character.spellSlots[level].current++;
            }
            renderSpellSlots();
            saveData();
        }

        function renderSpells() {
            const maxSpellLevel = getMaxSpellLevel();
            
            // Always Prepared (dynamic based on level)
            const alwaysContainer = document.getElementById('always-prepared');
            alwaysContainer.innerHTML = '';
            getAlwaysPrepared().forEach(spell => {
                const spellDiv = createSpellElement(spell, false, false);
                alwaysContainer.appendChild(spellDiv);
            });

            // Elementalist Spells - Show slots
            const elemContainer = document.getElementById('elementalist-spells');
            elemContainer.innerHTML = '';
            
            const slots = getElementalistSlotConfig();
            slots.forEach(slotConfig => {
                const spell = character.elementalistSlots[slotConfig.key];
                
                if (spell) {
                    // Slot has a spell
                    const spellDiv = createSpellElement(spell, true, true);
                    elemContainer.appendChild(spellDiv);
                } else {
                    // Empty slot
                    const emptyDiv = document.createElement('div');
                    emptyDiv.className = 'spell-item empty-slot';
                    
                    const name = document.createElement('span');
                    name.className = 'spell-name';
                    name.textContent = 'Sin preparar';
                    name.style.flex = '1';
                    
                    const level = document.createElement('span');
                    level.className = 'spell-level';
                    level.textContent = slotConfig.label;
                    
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'btn-swap';
                    selectBtn.style.background = '#2ecc71';
                    selectBtn.textContent = 'Elegir';
                    selectBtn.onclick = () => openElementalistSpellPicker(slotConfig);
                    
                    emptyDiv.appendChild(name);
                    emptyDiv.appendChild(level);
                    emptyDiv.appendChild(selectBtn);
                    elemContainer.appendChild(emptyDiv);
                }
            });

            // Aether Spells - Show slots (Level 10+)
            const aetherCategory = document.getElementById('aether-category');
            const aetherContainer = document.getElementById('aether-spells');
            const aetherSlots = getAetherSlotConfig();

            if (aetherSlots.length > 0) {
                aetherCategory.style.display = 'block';
                aetherContainer.innerHTML = '';

                aetherSlots.forEach(slotConfig => {
                    const spell = character.aetherSlots[slotConfig.key];

                    if (spell) {
                        // Slot has a spell
                        const spellDiv = createSpellElement(spell, true, true, 'aether');
                        aetherContainer.appendChild(spellDiv);
                    } else {
                        // Empty slot
                        const emptyDiv = document.createElement('div');
                        emptyDiv.className = 'spell-item empty-slot';

                        const name = document.createElement('span');
                        name.className = 'spell-name';
                        name.textContent = 'Sin preparar';
                        name.style.flex = '1';

                        const level = document.createElement('span');
                        level.className = 'spell-level';
                        level.textContent = slotConfig.label;

                        const selectBtn = document.createElement('button');
                        selectBtn.className = 'btn-swap';
                        selectBtn.style.background = '#9b59b6';
                        selectBtn.textContent = 'Elegir';
                        selectBtn.onclick = () => openAetherSpellPicker(slotConfig);

                        emptyDiv.appendChild(name);
                        emptyDiv.appendChild(level);
                        emptyDiv.appendChild(selectBtn);
                        aetherContainer.appendChild(emptyDiv);
                    }
                });
            } else {
                aetherCategory.style.display = 'none';
            }

            // Druid Spells - Only show prepared spells and add button
            const druidContainer = document.getElementById('druid-spells');
            druidContainer.innerHTML = '';
            
            // Show prepared spells
            character.preparedSpells.forEach(spellId => {
                const spell = druidSpells.find(s => s.id === spellId);
                if (spell) {
                    const spellLevel = spellLevelToNumber(spell.level);
                    if (spellLevel <= maxSpellLevel) {
                        const spellDiv = createSpellElement(spell, true, false);
                        druidContainer.appendChild(spellDiv);
                    }
                }
            });

            // Add button to prepare more spells
            const level = parseInt(document.getElementById('level').value);
            const maxPreparedByLevel = {
                1: 4, 2: 5, 3: 6, 4: 7, 5: 9, 6: 10, 7: 11, 8: 12, 9: 14,
                10: 15, 11: 16, 12: 16, 13: 17, 14: 17, 15: 18, 16: 18,
                17: 19, 18: 20, 19: 21, 20: 22
            };
            const maxPrepared = maxPreparedByLevel[level] || 4;
            
            if (character.preparedSpells.length < maxPrepared) {
                const addBtn = document.createElement('button');
                addBtn.className = 'btn-add-spell';
                addBtn.textContent = '+ Añadir Hechizo Preparado';
                addBtn.onclick = () => openDruidSpellPicker();
                druidContainer.appendChild(addBtn);
            }

            updatePreparedCount();
        }

        function openElementalistSpellPicker(slotConfig) {
            const modal = document.getElementById('swap-modal');
            const swapList = document.getElementById('swap-spell-list');
            const currentText = document.getElementById('swap-current-spell');

            currentText.innerHTML = `Seleccionar hechizo: <strong>${slotConfig.label}</strong>`;
            swapList.innerHTML = '';

            const availableSpells = elementalistSpellList[slotConfig.spellLevel] || [];
            const aetherSpellIds = getAetherSpellIds();

            availableSpells.forEach(spell => {
                const spellDiv = document.createElement('div');
                spellDiv.className = 'spell-item';
                spellDiv.style.marginBottom = '10px';

                // Check if already prepared as druid spell or in aether slots
                const alreadyPrepared = character.preparedSpells.includes(spell.id) || aetherSpellIds.includes(spell.id);
                if (alreadyPrepared) {
                    spellDiv.style.opacity = '0.5';
                    spellDiv.style.pointerEvents = 'none';
                }

                const name = document.createElement('span');
                name.className = 'spell-name spell-item-clickable';
                name.textContent = spell.name;
                name.style.flex = '1';
                name.style.cursor = 'pointer';
                if (!alreadyPrepared) {
                    name.onclick = (e) => {
                        e.stopPropagation();
                        showSpellDescription(spell.id);
                    };
                }

                const level = document.createElement('span');
                level.className = 'spell-level';
                level.textContent = spell.level;

                const selectBtn = document.createElement('button');
                selectBtn.className = 'btn-swap';
                selectBtn.style.fontSize = '1.2em';
                selectBtn.style.fontWeight = 'bold';
                
                if (alreadyPrepared) {
                    selectBtn.style.background = '#95a5a6';
                    selectBtn.textContent = '✓';
                    selectBtn.disabled = true;
                    const tooltipText = character.preparedSpells.includes(spell.id) ? 'Ya preparado como hechizo de Druida' : 'Ya preparado como hechizo de Aether';
                    selectBtn.title = tooltipText;
                } else {
                    selectBtn.style.background = '#2ecc71';
                    selectBtn.textContent = '+';
                    selectBtn.onclick = (e) => {
                        e.stopPropagation();
                        character.elementalistSlots[slotConfig.key] = spell;
                        closeSwapModal();
                        renderSpells();
                        saveData();
                    };
                }

                spellDiv.appendChild(name);
                spellDiv.appendChild(level);
                spellDiv.appendChild(selectBtn);
                swapList.appendChild(spellDiv);
            });

            modal.classList.add('active');
        }

        function openAetherSpellPicker(slotConfig) {
            const modal = document.getElementById('swap-modal');
            const swapList = document.getElementById('swap-spell-list');
            const currentText = document.getElementById('swap-current-spell');

            currentText.innerHTML = `Seleccionar hechizo Aether: <strong>${slotConfig.label}</strong>`;
            swapList.innerHTML = '';

            const availableSpells = aetherSpellList[slotConfig.spellLevel] || [];
            const elementalistSpellIds = getElementalistSpellIds();

            availableSpells.forEach(spell => {
                const spellDiv = document.createElement('div');
                spellDiv.className = 'spell-item';
                spellDiv.style.marginBottom = '10px';

                // Check if already prepared as druid spell or in elementalist slots
                const alreadyPrepared = character.preparedSpells.includes(spell.id) || elementalistSpellIds.includes(spell.id);
                if (alreadyPrepared) {
                    spellDiv.style.opacity = '0.5';
                    spellDiv.style.pointerEvents = 'none';
                }

                const name = document.createElement('span');
                name.className = 'spell-name spell-item-clickable';
                name.textContent = spell.name;
                name.style.flex = '1';
                name.style.cursor = 'pointer';
                if (!alreadyPrepared) {
                    name.onclick = (e) => {
                        e.stopPropagation();
                        showSpellDescription(spell.id);
                    };
                }

                const level = document.createElement('span');
                level.className = 'spell-level';
                level.textContent = spell.level;

                const selectBtn = document.createElement('button');
                selectBtn.className = 'btn-swap';
                selectBtn.style.fontSize = '1.2em';
                selectBtn.style.fontWeight = 'bold';

                if (alreadyPrepared) {
                    selectBtn.style.background = '#95a5a6';
                    selectBtn.textContent = '✓';
                    selectBtn.disabled = true;
                    const tooltipText = character.preparedSpells.includes(spell.id) ? 'Ya preparado como hechizo de Druida' : 'Ya preparado como hechizo Elementalista';
                    selectBtn.title = tooltipText;
                } else {
                    selectBtn.style.background = '#9b59b6';
                    selectBtn.textContent = '+';
                    selectBtn.onclick = (e) => {
                        e.stopPropagation();
                        character.aetherSlots[slotConfig.key] = spell;
                        closeSwapModal();
                        renderSpells();
                        saveData();
                    };
                }

                spellDiv.appendChild(name);
                spellDiv.appendChild(level);
                spellDiv.appendChild(selectBtn);
                swapList.appendChild(spellDiv);
            });

            modal.classList.add('active');
        }

        function openDruidSpellPicker() {
            const modal = document.getElementById('swap-modal');
            const swapList = document.getElementById('swap-spell-list');
            const currentText = document.getElementById('swap-current-spell');
            const maxSpellLevel = getMaxSpellLevel();
            const lockedSpellIds = getAllLockedSpellIds();
            const elementalistSpellIds = getElementalistSpellIds();
            const aetherSpellIds = getAetherSpellIds();

            currentText.innerHTML = `Seleccionar hechizo de Druida`;
            swapList.innerHTML = '';

            // Get all druid spells (including locked ones, we'll show them as disabled)
            const allSpells = druidSpells.filter(s => {
                const spellLevel = spellLevelToNumber(s.level);
                return !character.preparedSpells.includes(s.id) && spellLevel <= maxSpellLevel;
            });

            // Group by level
            const grouped = {};
            allSpells.forEach(spell => {
                if (!grouped[spell.level]) {
                    grouped[spell.level] = [];
                }
                grouped[spell.level].push(spell);
            });

            const levels = ['1st', '2nd', '3rd', '4th', '5th'];
            levels.forEach(level => {
                if (grouped[level] && grouped[level].length > 0) {
                    const header = document.createElement('h4');
                    header.style.color = '#7e22ce';
                    header.style.marginTop = '15px';
                    header.style.marginBottom = '10px';
                    header.textContent = `Nivel ${level}`;
                    swapList.appendChild(header);

                    grouped[level].forEach(spell => {
                        const isLocked = lockedSpellIds.includes(spell.id);
                        const isInElementalist = elementalistSpellIds.includes(spell.id);
                        const isInAether = aetherSpellIds.includes(spell.id);

                        const spellDiv = document.createElement('div');
                        spellDiv.className = 'spell-item';
                        spellDiv.style.marginBottom = '10px';

                        if (isLocked) {
                            spellDiv.style.opacity = '0.5';
                            spellDiv.style.pointerEvents = 'none';
                        }

                        const name = document.createElement('span');
                        name.className = 'spell-name spell-item-clickable';
                        name.textContent = spell.name;
                        name.style.flex = '1';
                        name.style.cursor = 'pointer';
                        if (!isLocked) {
                            name.onclick = (e) => {
                                e.stopPropagation();
                                showSpellDescription(spell.id);
                            };
                        }

                        const lvl = document.createElement('span');
                        lvl.className = 'spell-level';
                        lvl.textContent = spell.level;

                        const selectBtn = document.createElement('button');
                        selectBtn.className = 'btn-swap';
                        selectBtn.style.fontSize = '1.2em';
                        selectBtn.style.fontWeight = 'bold';

                        if (isLocked) {
                            selectBtn.style.background = '#95a5a6';
                            selectBtn.textContent = '✓';
                            selectBtn.disabled = true;
                            const tooltipText = isInElementalist ? 'Ya preparado como hechizo Elementalista' : 'Ya preparado como hechizo de Aether';
                            selectBtn.title = tooltipText;
                        } else {
                            selectBtn.style.background = '#2ecc71';
                            selectBtn.textContent = '+';
                            selectBtn.onclick = (e) => {
                                e.stopPropagation();
                                character.preparedSpells.push(spell.id);
                                closeSwapModal();
                                renderSpells();
                                saveData();
                            };
                        }

                        spellDiv.appendChild(name);
                        spellDiv.appendChild(lvl);
                        spellDiv.appendChild(selectBtn);
                        swapList.appendChild(spellDiv);
                    });
                }
            });

            if (allSpells.length === 0) {
                swapList.innerHTML = '<p style="text-align: center; color: #7f8c8d;">No hay hechizos disponibles.</p>';
            }

            modal.classList.add('active');
        }

        function createSpellElement(spell, canSwap, locked, slotType = 'druid') {
            const div = document.createElement('div');
            div.className = 'spell-item spell-item-clickable';

            // Make spell name clickable to show description
            const name = document.createElement('span');
            name.className = 'spell-name';
            name.textContent = spell.name;
            name.style.flex = '1';
            name.style.cursor = 'pointer';
            name.onclick = () => showSpellDescription(spell.id);

            const level = document.createElement('span');
            level.className = 'spell-level';
            level.textContent = spell.level;

            div.appendChild(name);
            div.appendChild(level);

            // Add swap button if applicable
            if (canSwap) {
                const swapBtn = document.createElement('button');
                swapBtn.className = 'btn-swap';
                swapBtn.textContent = '⇄';
                swapBtn.onclick = (e) => {
                    e.stopPropagation();
                    const modalType = locked ? (slotType === 'aether' ? 'aether' : 'elementalist') : 'druid';
                    openSwapModal(spell, modalType);
                };
                div.appendChild(swapBtn);
            }

            return div;
        }

        function showSpellDescription(spellId) {
            const spell = spellDescriptions[spellId];
            if (!spell) {
                alert('Descripción no disponible para este hechizo.');
                return;
            }

            // Close swap modal if it's open
            const swapModal = document.getElementById('swap-modal');
            const wasSwapModalOpen = swapModal.classList.contains('active');
            if (wasSwapModalOpen) {
                swapModal.classList.remove('active');
            }

            document.getElementById('modal-spell-name').textContent = spell.name;
            document.getElementById('modal-spell-meta').innerHTML = `
                <strong>${spell.level} ${spell.school}</strong><br>
                <strong>Tiempo de lanzamiento:</strong> ${spell.castingTime}<br>
                <strong>Alcance:</strong> ${spell.range}<br>
                <strong>Componentes:</strong> ${spell.components}<br>
                <strong>Duración:</strong> ${spell.duration}
            `;
            document.getElementById('modal-spell-description').innerHTML = spell.description;

            const spellModal = document.getElementById('spell-modal');
            spellModal.classList.add('active');
            
            // Store if we should reopen swap modal after closing description
            spellModal.dataset.reopenSwap = wasSwapModalOpen;
        }

        function closeSpellModal() {
            const spellModal = document.getElementById('spell-modal');
            const shouldReopenSwap = spellModal.dataset.reopenSwap === 'true';
            spellModal.classList.remove('active');
            
            // Reopen swap modal if it was open before
            if (shouldReopenSwap) {
                setTimeout(() => {
                    document.getElementById('swap-modal').classList.add('active');
                }, 100);
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('spell-modal');
            if (event.target === modal) {
                closeSpellModal();
            }
        });

        function openSwapModal(currentSpell, listType) {
            const modal = document.getElementById('swap-modal');
            const swapList = document.getElementById('swap-spell-list');
            const currentText = document.getElementById('swap-current-spell');
            const maxSpellLevel = getMaxSpellLevel();
            const lockedSpellIds = getAllLockedSpellIds();
            
            currentText.innerHTML = `Cambiando: <strong>${currentSpell.name}</strong> (${currentSpell.level})`;
            swapList.innerHTML = '';

            let availableSpells = [];

            if (listType === 'elementalist') {
                // Find which slot this spell is in
                let slotKey = null;
                for (let key in character.elementalistSlots) {
                    if (character.elementalistSlots[key] && character.elementalistSlots[key].id === currentSpell.id) {
                        slotKey = key;
                        break;
                    }
                }

                // Elementalist spells can only swap with same level
                availableSpells = elementalistSpellList[currentSpell.level] || [];
                availableSpells = availableSpells.filter(s => s.id !== currentSpell.id);

                availableSpells.forEach(spell => {
                    const spellDiv = createSwapSpellElement(spell, currentSpell, listType, slotKey);
                    swapList.appendChild(spellDiv);
                });
            } else if (listType === 'aether') {
                // Find which slot this spell is in
                let slotKey = null;
                for (let key in character.aetherSlots) {
                    if (character.aetherSlots[key] && character.aetherSlots[key].id === currentSpell.id) {
                        slotKey = key;
                        break;
                    }
                }

                // Aether spells can only swap with same level
                availableSpells = aetherSpellList[currentSpell.level] || [];
                availableSpells = availableSpells.filter(s => s.id !== currentSpell.id);

                availableSpells.forEach(spell => {
                    const spellDiv = createSwapSpellElement(spell, currentSpell, listType, slotKey);
                    swapList.appendChild(spellDiv);
                });
            } else {
                // Druid spells can swap with ANY level druid spell that isn't already prepared and not in elementalist/aether slots
                availableSpells = druidSpells.filter(s => {
                    const spellLevel = spellLevelToNumber(s.level);
                    return s.id !== currentSpell.id &&
                           !character.preparedSpells.includes(s.id) &&
                           !lockedSpellIds.includes(s.id) &&
                           spellLevel <= maxSpellLevel;
                });

                const grouped = {};
                availableSpells.forEach(spell => {
                    if (!grouped[spell.level]) {
                        grouped[spell.level] = [];
                    }
                    grouped[spell.level].push(spell);
                });

                const levels = ['1st', '2nd', '3rd', '4th', '5th'];
                levels.forEach(level => {
                    if (grouped[level] && grouped[level].length > 0) {
                        const header = document.createElement('h4');
                        header.style.color = '#7e22ce';
                        header.style.marginTop = '15px';
                        header.style.marginBottom = '10px';
                        header.textContent = `Nivel ${level}`;
                        swapList.appendChild(header);

                        grouped[level].forEach(spell => {
                            const spellDiv = createSwapSpellElement(spell, currentSpell, listType, null);
                            swapList.appendChild(spellDiv);
                        });
                    }
                });
            }

            if (availableSpells.length === 0) {
                swapList.innerHTML = '<p style="text-align: center; color: #7f8c8d;">No hay hechizos disponibles para intercambiar.</p>';
            }

            modal.classList.add('active');
        }

        function createSwapSpellElement(spell, currentSpell, listType, slotKey) {
            const spellDiv = document.createElement('div');
            spellDiv.className = 'spell-item';
            spellDiv.style.marginBottom = '10px';

            const name = document.createElement('span');
            name.className = 'spell-name spell-item-clickable';
            name.textContent = spell.name;
            name.style.flex = '1';
            name.style.cursor = 'pointer';
            name.onclick = (e) => {
                e.stopPropagation();
                showSpellDescription(spell.id);
            };

            const level = document.createElement('span');
            level.className = 'spell-level';
            level.textContent = spell.level;

            const swapBtn = document.createElement('button');
            swapBtn.className = 'btn-swap';
            swapBtn.textContent = '⇄';
            swapBtn.style.fontSize = '1.2em';
            swapBtn.onclick = (e) => {
                e.stopPropagation();
                performSwap(currentSpell, spell, listType, slotKey);
            };

            spellDiv.appendChild(name);
            spellDiv.appendChild(level);
            spellDiv.appendChild(swapBtn);

            return spellDiv;
        }

        function closeSwapModal() {
            document.getElementById('swap-modal').classList.remove('active');
        }

        function performSwap(oldSpell, newSpell, listType, slotKey) {
            if (listType === 'elementalist') {
                // Replace in elementalist slot
                if (slotKey) {
                    character.elementalistSlots[slotKey] = newSpell;
                }
            } else if (listType === 'aether') {
                // Replace in aether slot
                if (slotKey) {
                    character.aetherSlots[slotKey] = newSpell;
                }
            } else {
                // Replace in prepared spells
                const index = character.preparedSpells.indexOf(oldSpell.id);
                if (index !== -1) {
                    character.preparedSpells[index] = newSpell.id;
                }
            }

            closeSwapModal();
            renderSpells();
            saveData();
        }

        // Close swap modal when clicking outside
        document.addEventListener('click', function(event) {
            const swapModal = document.getElementById('swap-modal');
            if (event.target === swapModal) {
                closeSwapModal();
            }
        });

        function togglePrepared(spellId) {
            const index = character.preparedSpells.indexOf(spellId);
            const level = parseInt(document.getElementById('level').value);
            const maxPreparedByLevel = {
                1: 4, 2: 5, 3: 6, 4: 7, 5: 9, 6: 10, 7: 11, 8: 12, 9: 14,
                10: 15, 11: 16, 12: 16, 13: 17, 14: 17, 15: 18, 16: 18,
                17: 19, 18: 20, 19: 21, 20: 22
            };
            const maxPrepared = maxPreparedByLevel[level] || 4;

            if (index > -1) {
                character.preparedSpells.splice(index, 1);
            } else {
                if (character.preparedSpells.length < maxPrepared) {
                    character.preparedSpells.push(spellId);
                } else {
                    alert(`No puedes preparar más de ${maxPrepared} hechizos.`);
                    renderSpells();
                    return;
                }
            }

            updatePreparedCount();
            saveData();
        }

        function updatePreparedCount() {
            document.getElementById('prepared-count').textContent = character.preparedSpells.length;
        }

        function shortRest() {
            // Recover nothing on short rest for this class
            alert('Descanso Corto completado. Los druidas recuperan recursos en descansos largos.');
        }

        function longRest() {
            character.currentHP = character.maxHP;
            character.wildShapeCharges.current = character.wildShapeCharges.max;
            
            // Restore all spell slots
            for (let level in character.spellSlots) {
                character.spellSlots[level].current = character.spellSlots[level].max;
            }

            updateHP();
            renderWildShape();
            renderSpellSlots();
            saveData();
            
            alert('Descanso Largo completado. Todos los recursos han sido restaurados.');
        }

        function saveData() {
            localStorage.setItem('elementalistDruid', JSON.stringify(character));
        }

        function loadSavedData() {
            const saved = localStorage.getItem('elementalistDruid');
            if (saved) {
                const data = JSON.parse(saved);
                character = { ...character, ...data };
                
                document.getElementById('level').value = character.level;
                document.getElementById('wisdom').value = character.wisdom;
                document.getElementById('dexterity').value = character.dexterity;
                
                // Restore Elemental Armor display
                const armorDisplay = document.getElementById('elemental-armor');
                if (character.elementalArmor) {
                    armorDisplay.textContent = '✓';
                    armorDisplay.style.color = '#2ecc71';
                } else {
                    armorDisplay.textContent = '✗';
                    armorDisplay.style.color = '#e74c3c';
                }
                
                // Restore Pendant Level display
                const pendantDisplay = document.getElementById('pendant-level');
                pendantDisplay.textContent = character.pendantLevel || 'Dormant';
                const colors = {
                    'Dormant': '#95a5a6',
                    'Awakened': '#3498db',
                    'Exalted': '#f39c12'
                };
                pendantDisplay.style.color = colors[character.pendantLevel] || colors['Dormant'];
                
                updateStats();
                updateHP();
                renderWildShape();
                renderSpellSlots();
                renderSpells();
            }
        }

        // Event listeners
        document.getElementById('level').addEventListener('input', updateStats);
        document.getElementById('wisdom').addEventListener('input', updateStats);
        document.getElementById('dexterity').addEventListener('input', updateStats);
        document.getElementById('hp-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const value = parseInt(e.target.value) || 0;
                modifyHP(value);
            }
        });

        // Initialize on load
        init();
    </script>
</body>
</html>